<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nabokov's Web - Complete Implementation Plan</title>
    <style>
        :root {
            --chinese-red: #8B0000;
            --chinese-gold: #FFD700;
            --paper-beige: #FAF7F2;
            --light-cream: #F5F0E8;
            --ink-black: #3E3226;
            --level-1: #8B0000;
            --level-2: #8B7355;
            --level-3: #5C4D42;
            --level-4: #A89684;
        }

        body {
            background: linear-gradient(135deg, var(--paper-beige) 0%, var(--light-cream) 100%);
            color: var(--ink-black);
            margin: 0;
            padding: 0;
            width: 100vw;
            max-width: 100%;
            line-height: 1.2;
            font-size: 14px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        .container { width: 100%; padding: 12px; margin: 0; }

        h1 {
            font-size: 28px;
            font-weight: 900;
            margin: 8px 0;
            padding: 12px 16px;
            background: linear-gradient(135deg, var(--chinese-red), #CD5C5C);
            color: white;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(139, 0, 0, 0.3);
        }

        h2 {
            font-size: 20px;
            font-weight: 700;
            margin: 12px 0 6px 0;
            padding: 8px 12px;
            border-left: 4px solid var(--chinese-red);
            background: rgba(139, 0, 0, 0.03);
            color: var(--level-1);
        }

        h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 8px 0 4px 0;
            color: var(--level-2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        h4 {
            font-size: 14px;
            font-weight: 500;
            margin: 6px 0 3px 0;
            color: var(--level-3);
        }

        .collapsible {
            margin: 6px 0;
            width: 100%;
            border: 1px solid rgba(139, 0, 0, 0.1);
            border-radius: 4px;
        }

        .collapsible-header {
            cursor: pointer;
            padding: 8px 12px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.05), rgba(255, 215, 0, 0.02));
            border-left: 3px solid var(--chinese-gold);
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
            transition: all 0.2s ease;
            font-weight: 600;
            font-size: 14px;
        }

        .collapsible-header:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.1), rgba(255, 215, 0, 0.05));
        }

        .collapsible-header .arrow {
            display: inline-block;
            transition: transform 0.3s ease;
            color: var(--chinese-red);
            font-size: 12px;
            margin-right: 8px;
        }

        .collapsible.open .arrow {
            transform: rotate(90deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0 12px;
        }

        .collapsible.open .collapsible-content {
            max-height: 8000px;
            padding: 12px;
        }

        .critical-box {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.08), white);
            border: 2px solid var(--chinese-red);
            padding: 12px;
            margin: 8px 0;
            border-radius: 4px;
        }

        .important-always-visible {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), white);
            border: 2px solid var(--chinese-gold);
            padding: 10px;
            margin: 8px 0;
            border-radius: 4px;
        }

        .card {
            background: white;
            border: 1px solid rgba(139, 0, 0, 0.2);
            border-radius: 4px;
            padding: 10px;
            margin: 6px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card.priority {
            border: 2px solid var(--chinese-gold);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), white);
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 8px 0;
        }

        .three-column {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 8px 0;
        }

        pre, code {
            background: linear-gradient(135deg, rgba(245, 245, 220, 0.3), rgba(255, 255, 255, 0.5));
            border: 1px solid rgba(139, 0, 0, 0.1);
            padding: 3px 6px;
            margin: 2px 0;
            font-size: 12px;
            line-height: 1.3;
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            border-radius: 3px;
        }

        pre {
            padding: 10px;
            margin: 6px 0;
            overflow-x: auto;
        }

        ul, ol {
            margin: 6px 0 6px 20px;
        }

        li {
            margin: 3px 0;
            line-height: 1.4;
        }

        strong {
            color: var(--level-2);
            font-weight: 600;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 700;
            margin: 0 3px;
            text-transform: uppercase;
        }

        .badge.critical { background: rgba(255, 0, 0, 0.2); color: #8B0000; }
        .badge.hard { background: rgba(255, 0, 0, 0.15); color: #8B0000; }
        .badge.medium { background: rgba(255, 165, 0, 0.2); color: #FF8C00; }
        .badge.easy { background: rgba(0, 200, 0, 0.2); color: #006400; }
        .badge.new { background: rgba(138, 43, 226, 0.2); color: #4B0082; }
        .badge.done { background: rgba(0, 128, 0, 0.25); color: #006400; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 8px 0;
            font-size: 12px;
        }

        th, td {
            border: 1px solid rgba(139, 0, 0, 0.2);
            padding: 6px 8px;
            text-align: left;
            line-height: 1.3;
        }

        th {
            background: rgba(139, 0, 0, 0.1);
            font-weight: 600;
        }

        .divider {
            height: 2px;
            background: linear-gradient(90deg, var(--chinese-red), transparent);
            margin: 16px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .status-done { background: #00AA00; }
        .status-in-progress { background: #FF8C00; }
        .status-pending { background: #999; }

        .test-section {
            background: rgba(138, 43, 226, 0.05);
            border-left: 3px solid #8A2BE2;
            padding: 10px;
            margin: 8px 0;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const headers = document.querySelectorAll('.collapsible-header');
            headers.forEach(header => {
                header.addEventListener('click', function() {
                    this.parentElement.classList.toggle('open');
                });
            });

            // Auto-open critical sections
            document.querySelectorAll('.collapsible.critical').forEach(el => {
                el.classList.add('open');
            });
        });
    </script>
</head>
<body>

<div class="container">

<h1>üéØ Nabokov's Web - Complete Implementation Plan</h1>

<div class="important-always-visible">
    <h2 style="margin-top: 0;">üìã Executive Summary</h2>
    <div class="three-column" style="margin-top: 8px;">
        <div class="card">
            <strong>‚úÖ Completed (4 features)</strong>
            <ul style="margin: 6px 0 0 16px; font-size: 12px;">
                <li>Custom note cards (Cmd+N)</li>
                <li>Card connections (arrows)</li>
                <li>Inline editing</li>
                <li>Chat save as cards</li>
            </ul>
        </div>
        <div class="card priority">
            <strong>üöÄ Ready to Implement (12 features)</strong>
            <ul style="margin: 6px 0 0 16px; font-size: 12px;">
                <li>5 Phase 1 features (24-34h)</li>
                <li>3 Phase 2 features (28-38h)</li>
                <li>3 Phase 3 features (24-32h)</li>
                <li>1 Phase 4 polish (16-24h)</li>
            </ul>
        </div>
        <div class="card">
            <strong>üìä Total Effort</strong>
            <ul style="margin: 6px 0 0 16px; font-size: 12px;">
                <li>92-128 hours estimated</li>
                <li>~2-3 months at 10-15h/week</li>
                <li>All features testable</li>
            </ul>
        </div>
    </div>
</div>

<div class="divider"></div>

<h2>üóìÔ∏è Implementation Timeline</h2>

<table>
    <thead>
        <tr>
            <th style="width: 12%;">Phase</th>
            <th style="width: 40%;">Features</th>
            <th style="width: 12%;">Hours</th>
            <th style="width: 12%;">Priority</th>
            <th style="width: 12%;">Status</th>
            <th style="width: 12%;">Tests</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>Phase 1</strong></td>
            <td>Inline Context Input, Drag-Drop Images, Enhanced Chat, Collapsible/Resizable Cards</td>
            <td>24-34h</td>
            <td><span class="badge critical">Critical</span></td>
            <td><span class="status-indicator status-pending"></span>Pending</td>
            <td>Unit + E2E</td>
        </tr>
        <tr>
            <td><strong>Phase 2</strong></td>
            <td>Chrome Side Panel, Custom Buttons, Markdown</td>
            <td>28-38h</td>
            <td><span class="badge hard">High</span></td>
            <td><span class="status-indicator status-pending"></span>Pending</td>
            <td>Unit + E2E</td>
        </tr>
        <tr>
            <td><strong>Phase 3</strong></td>
            <td>Structured Cards, Template Editor, Card Templates</td>
            <td>24-32h</td>
            <td><span class="badge medium">Medium</span></td>
            <td><span class="status-indicator status-pending"></span>Pending</td>
            <td>Unit + E2E</td>
        </tr>
        <tr>
            <td><strong>Phase 4</strong></td>
            <td>Testing, Documentation, Performance</td>
            <td>16-24h</td>
            <td><span class="badge easy">Polish</span></td>
            <td><span class="status-indicator status-pending"></span>Pending</td>
            <td>Full Suite</td>
        </tr>
    </tbody>
</table>

<div class="divider"></div>

<div class="collapsible critical open">
    <div class="collapsible-header">
        <div><span class="arrow">‚ñ∂</span>Phase 1: Foundation Features (24-34h) <span class="badge critical">Critical Path</span></div>
    </div>
    <div class="collapsible-content">

<h3>1.1 Inline Context Input System <span class="badge hard">10-12h</span></h3>

<div class="critical-box">
    <strong>Why Critical:</strong> This is the foundation for ALL custom button actions. Without it, custom buttons can't be personalized. Blocks Phase 2 & 3.
</div>

<h4>Implementation Steps</h4>

<table style="font-size: 11px;">
    <tr>
        <th style="width: 5%;">Step</th>
        <th style="width: 35%;">File/Component</th>
        <th style="width: 45%;">Task</th>
        <th style="width: 15%;">Time</th>
    </tr>
    <tr>
        <td>1</td>
        <td><code>src/components/ContextInputModal.tsx</code></td>
        <td>Create modal with input field, skip/submit buttons, keyboard handlers</td>
        <td>2-3h</td>
    </tr>
    <tr>
        <td>2</td>
        <td><code>src/config/defaultButtons.ts</code></td>
        <td>Define 5 default buttons (Learn More, Summarize, Critique, ELI5, Expand)</td>
        <td>1h</td>
    </tr>
    <tr>
        <td>3</td>
        <td><code>src/services/cardGenerationService.ts</code></td>
        <td>Create service for LLM-based card generation from button actions</td>
        <td>3-4h</td>
    </tr>
    <tr>
        <td>4</td>
        <td><code>src/canvas/CardNode.tsx</code></td>
        <td>Add action buttons row to card footer, wire up modal trigger</td>
        <td>2h</td>
    </tr>
    <tr>
        <td>5</td>
        <td><code>src/types/card.ts</code></td>
        <td>Add CardButton interface, update Card interface</td>
        <td>1h</td>
    </tr>
    <tr>
        <td>6</td>
        <td>Testing</td>
        <td>Unit tests for modal, button config, card generation service</td>
        <td>2-3h</td>
    </tr>
</table>

<div class="test-section">
    <strong>Test Plan for 1.1:</strong>
    <ul style="margin: 4px 0 0 16px; font-size: 12px;">
        <li><strong>Unit:</strong> ContextInputModal renders, keyboard shortcuts work, button config loads</li>
        <li><strong>Integration:</strong> Card generation service creates cards with correct parentId, connections</li>
        <li><strong>E2E:</strong> Click "Learn More" ‚Üí modal opens ‚Üí enter context ‚Üí new card appears ‚Üí connection visible</li>
    </ul>
</div>

<h3>1.2 Drag-and-Drop Image Upload <span class="badge new">4-6h</span> <span class="badge easy">High Value</span></h3>

<div class="critical-box">
    <strong>üéØ Game Changer:</strong> Replaces problematic automatic screenshot capture. Users take their own screenshots (Cmd+Shift+4, Snipping Tool) and drag into canvas. No CORS issues, 100% reliable.
</div>

<h4>Implementation Steps</h4>

<table style="font-size: 11px;">
    <tr>
        <th style="width: 5%;">Step</th>
        <th style="width: 35%;">File/Component</th>
        <th style="width: 45%;">Task</th>
        <th style="width: 15%;">Time</th>
    </tr>
    <tr>
        <td>1</td>
        <td><code>src/types/card.ts</code></td>
        <td>Add <code>imageOnly: boolean</code> field to Card interface</td>
        <td>15min</td>
    </tr>
    <tr>
        <td>2</td>
        <td><code>src/utils/imageUpload.ts</code></td>
        <td>Create utility: validate file type, read as data URL, compress if needed</td>
        <td>1-1.5h</td>
    </tr>
    <tr>
        <td>3</td>
        <td><code>src/canvas/Canvas.tsx</code></td>
        <td>Add drag-and-drop event handlers (dragover, drop, visual feedback)</td>
        <td>1-1.5h</td>
    </tr>
    <tr>
        <td>4</td>
        <td><code>src/canvas/Canvas.tsx</code></td>
        <td>Implement card creation: save image to IndexedDB, create Card, add to canvas</td>
        <td>1h</td>
    </tr>
    <tr>
        <td>5</td>
        <td><code>src/canvas/CardNode.tsx</code></td>
        <td>Add image-only card rendering mode (no HTML content, just image)</td>
        <td>30min</td>
    </tr>
    <tr>
        <td>6</td>
        <td>Testing</td>
        <td>E2E tests: drag image ‚Üí verify card ‚Üí reload ‚Üí verify persists</td>
        <td>1h</td>
    </tr>
</table>

<div class="test-section">
    <strong>Test Plan for 1.2:</strong>
    <ul style="margin: 4px 0 0 16px; font-size: 12px;">
        <li><strong>Unit:</strong> Image file validation, compression logic, data URL conversion</li>
        <li><strong>E2E:</strong> Drag single image ‚Üí card appears at drop position</li>
        <li><strong>E2E:</strong> Drag multiple images ‚Üí cards created with offset</li>
        <li><strong>E2E:</strong> Invalid file type ‚Üí graceful error handling</li>
    </ul>
</div>

<h4>Why This Replaces Auto-Screenshots</h4>
<ul style="margin-left: 16px; font-size: 13px;">
    <li><strong>No CORS Issues:</strong> User controls image source, no browser restrictions</li>
    <li><strong>100% Reliable:</strong> No canvas tainting, no captureVisibleTab failures</li>
    <li><strong>User Control:</strong> Take screenshot exactly how they want it</li>
    <li><strong>Simpler Code:</strong> Remove complex captureVisibleTab + cropping logic</li>
</ul>

<h3>1.3 Enhanced Chat Cards <span class="badge easy">4-5h</span></h3>

<h4>Improvements</h4>
<ul style="margin-left: 16px; font-size: 13px;">
    <li><strong>Prominent save button:</strong> Larger, gold gradient, always visible in FloatingWindow</li>
    <li><strong>Auto-save on close:</strong> Checkbox option to save conversation when closing window</li>
    <li><strong>Continue chat button:</strong> For generated cards with conversations, show "Continue Chat" button</li>
</ul>

<h4>Files to Modify</h4>
<ul style="margin-left: 16px; font-size: 13px;">
    <li><code>src/components/FloatingWindow.tsx</code> - Add auto-save checkbox, improve save button styling</li>
    <li><code>src/canvas/CardNode.tsx</code> - Add "Continue Chat" button for generated cards</li>
</ul>

<div class="test-section">
    <strong>Test Plan for 1.3:</strong>
    <ul style="margin: 4px 0 0 16px; font-size: 12px;">
        <li><strong>Unit:</strong> Auto-save checkbox state persists, continue button shows only for generated cards</li>
        <li><strong>E2E:</strong> Enable auto-save ‚Üí close window ‚Üí verify card saved with conversation</li>
    </ul>
</div>

<h3>1.4 Collapsible Cards <span class="badge easy">2-3h</span></h3>

<h4>Implementation</h4>
<ul style="margin-left: 16px; font-size: 13px;">
    <li>Add <code>visualState: { collapsed: boolean }</code> to Card interface</li>
    <li>Add collapse/expand button to CardNode header (‚ñ∂/‚ñº)</li>
    <li>Collapsed state: show only header (60px height)</li>
    <li>Save state to chrome.storage.local</li>
</ul>

<div class="test-section">
    <strong>Test Plan for 1.4:</strong>
    <ul style="margin: 4px 0 0 16px; font-size: 12px;">
        <li><strong>Unit:</strong> Collapsed state toggles correctly, height changes</li>
        <li><strong>E2E:</strong> Collapse card ‚Üí reload ‚Üí verify still collapsed</li>
    </ul>
</div>

<h3>1.5 Resizable Cards <span class="badge medium">4-6h</span></h3>

<h4>Size Presets</h4>
<ul style="margin-left: 16px; font-size: 13px;">
    <li><strong>Small:</strong> 240x180px</li>
    <li><strong>Medium:</strong> 320x240px (default)</li>
    <li><strong>Large:</strong> 480x360px</li>
    <li><strong>XLarge:</strong> 640x480px</li>
</ul>

<h4>Implementation</h4>
<ul style="margin-left: 16px; font-size: 13px;">
    <li>Create <code>src/config/cardSizes.ts</code> with preset definitions</li>
    <li>Add size control buttons (S/M/L/XL) to CardNode header</li>
    <li>Update Card.size and Card.visualState.size on change</li>
</ul>

<div class="test-section">
    <strong>Test Plan for 1.5:</strong>
    <ul style="margin: 4px 0 0 16px; font-size: 12px;">
        <li><strong>Unit:</strong> Size presets apply correct dimensions</li>
        <li><strong>E2E:</strong> Change size ‚Üí reload ‚Üí verify size persists</li>
    </ul>
</div>

    </div>
</div>

<div class="collapsible">
    <div class="collapsible-header">
        <div><span class="arrow">‚ñ∂</span>Phase 2: Browser Integration & Extensibility (28-38h) <span class="badge new">Game-Changing</span></div>
    </div>
    <div class="collapsible-content">

<h3>2.1 Chrome Side Panel Stash <span class="badge new">8-12h</span></h3>

<div class="critical-box">
    <strong>Why Game-Changing:</strong> Chrome's native Side Panel API provides persistent, always-accessible UI. Perfect for quick access to stashed cards without cluttering the canvas.
</div>

<h4>Implementation Steps</h4>

<table style="font-size: 11px;">
    <tr>
        <th style="width: 5%;">Step</th>
        <th style="width: 35%;">File</th>
        <th style="width: 45%;">Task</th>
        <th style="width: 15%;">Time</th>
    </tr>
    <tr>
        <td>1</td>
        <td><code>src/manifest.json</code></td>
        <td>Add "sidePanel" permission, configure default_path</td>
        <td>15min</td>
    </tr>
    <tr>
        <td>2</td>
        <td><code>src/sidepanel/index.html</code></td>
        <td>Create side panel HTML with stash list UI</td>
        <td>1-2h</td>
    </tr>
    <tr>
        <td>3</td>
        <td><code>src/sidepanel/sidepanel.ts</code></td>
        <td>Implement stash list logic: load, restore, delete cards</td>
        <td>4-6h</td>
    </tr>
    <tr>
        <td>4</td>
        <td><code>src/canvas/CardNode.tsx</code></td>
        <td>Add stash button (üì¶) to card header</td>
        <td>1h</td>
    </tr>
    <tr>
        <td>5</td>
        <td><code>src/types/card.ts</code></td>
        <td>Add stashed field and stashMetadata to Card</td>
        <td>30min</td>
    </tr>
    <tr>
        <td>6</td>
        <td><code>src/background/index.ts</code></td>
        <td>Enable side panel on icon click</td>
        <td>30min</td>
    </tr>
    <tr>
        <td>7</td>
        <td>Testing</td>
        <td>E2E tests for stash/restore/delete operations</td>
        <td>2-3h</td>
    </tr>
</table>

<div class="test-section">
    <strong>Test Plan for 2.1:</strong>
    <ul style="margin: 4px 0 0 16px; font-size: 12px;">
        <li><strong>E2E:</strong> Stash card ‚Üí verify in side panel ‚Üí restore ‚Üí verify on canvas</li>
        <li><strong>E2E:</strong> Delete from side panel ‚Üí verify removed from storage</li>
        <li><strong>E2E:</strong> Side panel updates when card stashed from canvas</li>
    </ul>
</div>

<h3>2.2 Custom Button System <span class="badge hard">12-16h</span></h3>

<h4>Features</h4>
<ul style="margin-left: 16px; font-size: 13px;">
    <li>Global button configuration (applies to all cards)</li>
    <li>Per-card custom buttons (override global)</li>
    <li>Settings UI for managing buttons</li>
    <li>Prompt templates with variables ({{content}}, {{title}}, {{customContext}})</li>
</ul>

<h4>Implementation</h4>
<ul style="margin-left: 16px; font-size: 13px;">
    <li><code>src/config/buttonStorage.ts</code> - Load/save global button configs</li>
    <li><code>src/canvas/SettingsPanel.tsx</code> - Add button management section</li>
    <li><code>src/types/card.ts</code> - Add CardButton interface</li>
</ul>

<div class="test-section">
    <strong>Test Plan for 2.2:</strong>
    <ul style="margin: 4px 0 0 16px; font-size: 12px;">
        <li><strong>Unit:</strong> Button config CRUD operations work</li>
        <li><strong>E2E:</strong> Add custom button ‚Üí verify appears on cards ‚Üí click ‚Üí verify prompt uses template</li>
    </ul>
</div>

<h3>2.3 Markdown Support <span class="badge medium">8-10h</span></h3>

<h4>Implementation</h4>
<ul style="margin-left: 16px; font-size: 13px;">
    <li>Install: <code>npm install marked dompurify</code></li>
    <li>Add <code>contentFormat: 'html' | 'markdown'</code> to Card</li>
    <li>Create <code>src/utils/contentRenderer.ts</code> for rendering</li>
    <li>Update CardNode to use renderer</li>
</ul>

<div class="test-section">
    <strong>Test Plan for 2.3:</strong>
    <ul style="margin: 4px 0 0 16px; font-size: 12px;">
        <li><strong>Unit:</strong> Markdown rendering works, XSS protection active</li>
        <li><strong>E2E:</strong> Create markdown card ‚Üí verify renders with formatting</li>
    </ul>
</div>

    </div>
</div>

<div class="collapsible">
    <div class="collapsible-header">
        <div><span class="arrow">‚ñ∂</span>Phase 3: Advanced Features (24-32h)</div>
    </div>
    <div class="collapsible-content">

<h3>3.1 Structured Card Components <span class="badge medium">12-16h</span></h3>

<p style="margin: 6px 0; font-size: 13px;">Allow cards to have collapsible sections, header/footer panels, metadata displays.</p>

<h3>3.2 Prompt Template Editor <span class="badge medium">8-12h</span></h3>

<p style="margin: 6px 0; font-size: 13px;">Rich text editor for creating/editing button prompts with template variable support.</p>

<h3>3.3 Card Templates <span class="badge easy">4-6h</span></h3>

<p style="margin: 6px 0; font-size: 13px;">Predefined card structures (e.g., "Research Note", "Meeting Summary", "Code Review").</p>

    </div>
</div>

<div class="collapsible">
    <div class="collapsible-header">
        <div><span class="arrow">‚ñ∂</span>Phase 4: Testing, Documentation & Performance (16-24h)</div>
    </div>
    <div class="collapsible-content">

<h3>Testing Strategy</h3>

<div class="two-column">
    <div class="card">
        <strong>Unit Tests (Vitest)</strong>
        <ul style="margin: 6px 0 0 16px; font-size: 12px;">
            <li>ContextInputModal component</li>
            <li>Button configuration storage</li>
            <li>Card generation service</li>
            <li>Markdown renderer</li>
            <li>Stash operations</li>
        </ul>
    </div>
    <div class="card">
        <strong>E2E Tests (Playwright)</strong>
        <ul style="margin: 6px 0 0 16px; font-size: 12px;">
            <li>Complete workflows (create ‚Üí customize ‚Üí generate ‚Üí stash)</li>
            <li>Side panel interactions</li>
            <li>Custom button actions</li>
            <li>Card resize/collapse persistence</li>
        </ul>
    </div>
</div>

<h3>Performance Optimization</h3>

<ul style="margin-left: 16px; font-size: 13px;">
    <li>Lazy load card content for large canvases</li>
    <li>Virtual scrolling for 1000+ cards</li>
    <li>Debounce save operations (already implemented)</li>
    <li>Cache markdown renders</li>
</ul>

<h3>Documentation</h3>

<ul style="margin-left: 16px; font-size: 13px;">
    <li>User guide for custom buttons</li>
    <li>Button template library with examples</li>
    <li>Developer API documentation</li>
    <li>Video tutorials (optional)</li>
</ul>

    </div>
</div>

<div class="divider"></div>

<h2>üîó Feature Dependency Graph</h2>

<pre style="font-size: 11px; line-height: 1.5;">
<strong>Phase 1 Foundation (Parallel execution possible)</strong>
‚îú‚îÄ <strong style="color: #8B0000;">Inline Context Input</strong> ‚Üê BLOCKS ‚Üí Custom Buttons (Phase 2)
‚îÇ  ‚îî‚îÄ ContextInputModal
‚îÇ  ‚îî‚îÄ cardGenerationService
‚îÇ  ‚îî‚îÄ defaultButtons config
‚îÇ
‚îú‚îÄ <strong style="color: #4B0082;">Drag-Drop Images</strong> ‚Üê Independent (REPLACES auto-screenshots, no CORS issues)
‚îÇ  ‚îî‚îÄ imageUpload utility
‚îÇ  ‚îî‚îÄ Canvas drag-drop handlers
‚îÇ  ‚îî‚îÄ Image-only card type
‚îÇ
‚îú‚îÄ Enhanced Chat Cards ‚Üê Independent (can implement anytime)
‚îÇ
‚îú‚îÄ Collapsible Cards ‚Üê Independent (enables better Side Panel UX in Phase 2)
‚îÇ
‚îî‚îÄ Resizable Cards ‚Üê Independent

<strong>Phase 2 Integration (Depends on Phase 1)</strong>
‚îú‚îÄ Chrome Side Panel ‚Üê Requires: Collapsible (for preview in stash)
‚îÇ  ‚îî‚îÄ manifest.json updates
‚îÇ  ‚îî‚îÄ sidepanel/ directory
‚îÇ  ‚îî‚îÄ Card.stashed field
‚îÇ
‚îú‚îÄ Custom Button System ‚Üê <strong style="color: #8B0000;">Requires: Inline Context Input</strong>
‚îÇ  ‚îî‚îÄ Button config storage
‚îÇ  ‚îî‚îÄ Settings UI
‚îÇ
‚îî‚îÄ Markdown Support ‚Üê Independent

<strong>Phase 3 Advanced (Depends on Phase 2)</strong>
‚îú‚îÄ Structured Cards ‚Üê Requires: Collapsible, Markdown
‚îú‚îÄ Prompt Editor ‚Üê Requires: Custom Button System
‚îî‚îÄ Card Templates ‚Üê Requires: Structured Cards

<strong>Phase 4 Polish (Depends on all above)</strong>
‚îî‚îÄ Testing, Docs, Performance
</pre>

<div class="divider"></div>

<h2>‚úÖ Implementation Checklist</h2>

<table style="font-size: 12px;">
    <thead>
        <tr>
            <th style="width: 4%;">‚úì</th>
            <th style="width: 40%;">Feature</th>
            <th style="width: 10%;">Phase</th>
            <th style="width: 10%;">Hours</th>
            <th style="width: 12%;">Priority</th>
            <th style="width: 12%;">Status</th>
            <th style="width: 12%;">Tests</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>‚òê</td>
            <td><strong>Inline Context Input System</strong></td>
            <td>1</td>
            <td>10-12h</td>
            <td><span class="badge critical">Critical</span></td>
            <td>Pending</td>
            <td>Unit + E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td><strong>Drag-and-Drop Image Upload</strong></td>
            <td>1</td>
            <td>4-6h</td>
            <td><span class="badge new">Game-changer</span></td>
            <td>Pending</td>
            <td>Unit + E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td>Enhanced Chat Cards</td>
            <td>1</td>
            <td>4-5h</td>
            <td><span class="badge easy">Easy</span></td>
            <td>Pending</td>
            <td>E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td>Collapsible Cards</td>
            <td>1</td>
            <td>2-3h</td>
            <td><span class="badge easy">Easy</span></td>
            <td>Pending</td>
            <td>Unit + E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td>Resizable Cards</td>
            <td>1</td>
            <td>4-6h</td>
            <td><span class="badge medium">Medium</span></td>
            <td>Pending</td>
            <td>E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td><strong>Chrome Side Panel Stash</strong></td>
            <td>2</td>
            <td>8-12h</td>
            <td><span class="badge new">Game-changer</span></td>
            <td>Pending</td>
            <td>E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td>Custom Button System</td>
            <td>2</td>
            <td>12-16h</td>
            <td><span class="badge hard">Hard</span></td>
            <td>Pending</td>
            <td>Unit + E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td>Markdown Support</td>
            <td>2</td>
            <td>8-10h</td>
            <td><span class="badge medium">Medium</span></td>
            <td>Pending</td>
            <td>Unit + E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td>Structured Card Components</td>
            <td>3</td>
            <td>12-16h</td>
            <td><span class="badge medium">Medium</span></td>
            <td>Pending</td>
            <td>Unit + E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td>Prompt Template Editor</td>
            <td>3</td>
            <td>8-12h</td>
            <td><span class="badge medium">Medium</span></td>
            <td>Pending</td>
            <td>E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td>Card Templates</td>
            <td>3</td>
            <td>4-6h</td>
            <td><span class="badge easy">Easy</span></td>
            <td>Pending</td>
            <td>E2E</td>
        </tr>
        <tr>
            <td>‚òê</td>
            <td>Testing & Documentation</td>
            <td>4</td>
            <td>16-24h</td>
            <td><span class="badge easy">Polish</span></td>
            <td>Pending</td>
            <td>Full Suite</td>
        </tr>
    </tbody>
</table>

<div class="divider"></div>

<div class="critical-box">
    <h2 style="margin-top: 0;">üöÄ Next Steps - Start Here</h2>

    <h3 style="margin: 8px 0 4px 0;">Day 1-3: Inline Context Input System (Critical Path)</h3>
    <ol style="margin-left: 20px; font-size: 13px;">
        <li>Create <code>src/components/ContextInputModal.tsx</code></li>
        <li>Create <code>src/config/defaultButtons.ts</code></li>
        <li>Create <code>src/services/cardGenerationService.ts</code></li>
        <li>Update <code>src/canvas/CardNode.tsx</code> with action buttons</li>
        <li>Write tests in <code>tests/unit/</code> and <code>tests/e2e/</code></li>
    </ol>

    <h3 style="margin: 12px 0 4px 0;">Day 4-5: Drag-and-Drop Image Upload (High Value)</h3>
    <ol style="margin-left: 20px; font-size: 13px;">
        <li>Add <code>imageOnly: boolean</code> to <code>src/types/card.ts</code></li>
        <li>Create <code>src/utils/imageUpload.ts</code> (validation, compression)</li>
        <li>Add drag-drop handlers to <code>src/canvas/Canvas.tsx</code></li>
        <li>Update <code>src/canvas/CardNode.tsx</code> for image-only rendering</li>
        <li><strong>Remove:</strong> Delete automatic screenshot capture code (captureVisibleTab logic)</li>
        <li>Write E2E tests for drag-drop workflow</li>
    </ol>

    <h3 style="margin: 12px 0 4px 0;">Day 6+: Remaining Phase 1 Features</h3>
    <ul style="margin-left: 20px; font-size: 13px;">
        <li>Enhanced Chat Cards (Day 6-7)</li>
        <li>Collapsible Cards (Day 7)</li>
        <li>Resizable Cards (Day 8-9)</li>
    </ul>

    <h3 style="margin: 12px 0 4px 0;">Testing Infrastructure (Existing)</h3>
    <ul style="margin-left: 20px; font-size: 13px;">
        <li><strong>Unit:</strong> <code>npm test</code> (Vitest + jsdom)</li>
        <li><strong>E2E:</strong> <code>npm run test:e2e</code> (Playwright)</li>
        <li><strong>Manual:</strong> <code>node test-scripts/test-*.mjs</code></li>
    </ul>

    <h3 style="margin: 12px 0 4px 0;">Code Reuse Strategy</h3>
    <ul style="margin-left: 20px; font-size: 13px;">
        <li>Reuse <code>chatService</code> for card generation LLM calls</li>
        <li>Reuse <code>FloatingWindow</code> pattern for modal components</li>
        <li>Reuse <code>saveCard/generateId</code> utilities</li>
        <li>Reuse <code>IndexedDB screenshot storage</code> for image cards</li>
        <li>Reuse <code>addConnection</code> for button-generated cards</li>
    </ul>

    <div style="background: rgba(138, 43, 226, 0.1); border-left: 3px solid #8A2BE2; padding: 8px; margin-top: 12px;">
        <strong>üí° Pro Tip:</strong> Implement Drag-Drop Images (1.2) right after Inline Context (1.1) to get immediate value and eliminate CORS issues. The remaining features can run in parallel.
    </div>
</div>

</div>

</body>
</html>
