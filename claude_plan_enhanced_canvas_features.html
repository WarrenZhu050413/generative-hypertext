<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced Canvas Features - Implementation Plan</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #faf7f2;
      color: #3e3226;
    }
    h1 {
      color: #8B0000;
      border-bottom: 3px solid #FFD700;
      padding-bottom: 10px;
    }
    h2 {
      color: #8B0000;
      margin-top: 40px;
      border-left: 4px solid #FFD700;
      padding-left: 15px;
    }
    h3 {
      color: #5C4D42;
      margin-top: 30px;
    }
    h4 {
      color: #8B7355;
      margin-top: 20px;
    }
    .feature-box {
      background: white;
      border: 2px solid #FFD700;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 8px rgba(139, 0, 0, 0.1);
    }
    .priority {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 10px;
    }
    .p1 { background: #8B0000; color: white; }
    .p2 { background: #D4AF37; color: white; }
    .p3 { background: #B89C82; color: white; }
    .code-block {
      background: rgba(255, 215, 0, 0.05);
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 4px;
      padding: 15px;
      margin: 15px 0;
      overflow-x: auto;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 13px;
    }
    .insight {
      background: rgba(212, 175, 55, 0.1);
      border-left: 4px solid #D4AF37;
      padding: 15px;
      margin: 15px 0;
      font-style: italic;
    }
    .benefit {
      color: #8B0000;
      font-weight: 600;
    }
    .architecture-note {
      background: rgba(139, 0, 0, 0.05);
      border: 2px dashed #8B0000;
      padding: 15px;
      margin: 15px 0;
      border-radius: 8px;
    }
    ul, ol {
      margin: 10px 0;
      padding-left: 30px;
    }
    li {
      margin: 8px 0;
    }
    .phase {
      background: linear-gradient(135deg, rgba(139, 0, 0, 0.05) 0%, rgba(212, 175, 55, 0.05) 100%);
      border-radius: 8px;
      padding: 20px;
      margin: 30px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: white;
    }
    th, td {
      border: 1px solid rgba(212, 175, 55, 0.3);
      padding: 12px;
      text-align: left;
    }
    th {
      background: rgba(139, 0, 0, 0.1);
      font-weight: 600;
      color: #8B0000;
    }
    .epic {
      margin-bottom: 50px;
    }
  </style>
</head>
<body>

<h1>üé® Enhanced Canvas Features: Implementation Plan</h1>

<div class="insight">
  <strong>Context:</strong> Building on the floating windows implementation, this plan extends Nabokov's Web toward the distributed cognition vision outlined in DESIGN.md. The system currently supports web clipping and chat conversations, but needs key capabilities to enable true "output as input" workflows and networked artifact thinking.
</div>

<h2>üìã Executive Summary</h2>

<div class="feature-box">
  <h3>User-Requested Features</h3>
  <ol>
    <li><strong>Persist chat conversations as cards</strong> - Save AI responses as new artifacts</li>
    <li><strong>Edit card content</strong> - Double-click to edit text inline</li>
    <li><strong>Create custom notes</strong> - Add blank note cards from canvas</li>
    <li><strong>Connect cards with arrows</strong> - Visual relationships via React Flow edges</li>
    <li><strong>Additional identified features</strong> - 15+ enhancements from codebase analysis</li>
  </ol>
</div>

<div class="architecture-note">
  <strong>üîç Code Analysis Insights:</strong>
  <ul>
    <li>React Flow edges are imported but unused (line 44 in useCanvasState.ts: <code>const [edges] = useState&lt;Edge[]&gt;([]);</code>)</li>
    <li>No card type distinction - all cards are clipped web content</li>
    <li>No contentEditable or editing infrastructure</li>
    <li>Conversation arrays exist on cards but aren't leveraged for card creation</li>
    <li>WindowManager provides foundation for multi-window workflows</li>
    <li>Screenshot system (IndexedDB) could support file/image artifacts</li>
  </ul>
</div>

<hr>

<h2>üéØ Phase 1: Core Interaction Enhancements</h2>
<p><span class="priority p1">P1</span> Foundation for distributed cognition workflows</p>

<div class="epic">
  <h3>Feature 1.1: Persist Chat Conversations as Cards</h3>
  <span class="priority p1">P1</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p><span class="benefit">Output as Input Principle:</span> Every AI response can spawn a new artifact that lives on the canvas and can be further explored.</p>

    <h4>üèóÔ∏è Implementation</h4>

    <p><strong>1. Add "Save as Card" button to FloatingWindowChat.tsx</strong></p>
    <div class="code-block">
interface FloatingWindowChatProps {
  // ... existing props
  onSaveAsCard?: (content: string, parentCardId: string) => void;
}

// In message rendering:
{messages.map((msg: Message) => (
  &lt;div key={msg.id}&gt;
    &lt;div&gt;{msg.content}&lt;/div&gt;
    {msg.role === 'assistant' && (
      &lt;button onClick={() => onSaveAsCard(msg.content, cardId)}&gt;
        üíæ Save as Card
      &lt;/button&gt;
    )}
  &lt;/div&gt;
))}
    </div>

    <p><strong>2. Extend Card type to support generated artifacts</strong></p>
    <div class="code-block">
interface Card {
  // ... existing fields
  cardType?: 'clipped' | 'generated' | 'note';
  parentCardId?: string; // Reference to card this was generated from
  generationContext?: {
    sourceMessageId: string;
    userPrompt: string;
    timestamp: number;
  };
}
    </div>

    <p><strong>3. Create card generation service</strong></p>
    <div class="code-block">
// src/services/cardGenerator.ts
export async function createCardFromConversation(
  message: Message,
  parentCard: Card,
  position?: CardPosition
): Promise&lt;Card&gt; {
  const newCard: Card = {
    id: generateId(),
    content: message.content,
    cardType: 'generated',
    parentCardId: parentCard.id,
    generationContext: {
      sourceMessageId: message.id,
      userPrompt: findUserPrompt(parentCard.conversation, message.id),
      timestamp: Date.now()
    },
    metadata: {
      url: '', // Generated cards don't have source URLs
      title: extractTitle(message.content) || 'Generated Response',
      domain: 'ai-generated',
      favicon: 'ü§ñ',
      timestamp: Date.now()
    },
    position: position || calculateOffsetPosition(parentCard.position),
    starred: false,
    tags: [...parentCard.tags, 'generated'],
    createdAt: Date.now(),
    updatedAt: Date.now(),
    conversation: [] // New card starts with empty conversation
  };

  await saveCard(newCard);

  // Optionally create edge connection
  await createEdge(parentCard.id, newCard.id, 'generated-from');

  return newCard;
}
    </div>

    <h4>‚ú® UX Flow</h4>
    <ol>
      <li>User chats with card in floating window</li>
      <li>AI responds with useful information</li>
      <li>User clicks "üíæ Save as Card" on response</li>
      <li>New card appears on canvas near parent card</li>
      <li>Visual arrow shows parent-child relationship</li>
      <li>New card has full conversation capabilities</li>
    </ol>

    <h4>üé® Visual Styling</h4>
    <ul>
      <li>Generated cards: Lighter background, ü§ñ icon</li>
      <li>Badge showing "Generated from [Parent Title]"</li>
      <li>Different border color (gold vs red for clipped)</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 1.2: Inline Content Editing</h3>
  <span class="priority p1">P1</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p><span class="benefit">Direct Manipulation:</span> Enable users to annotate, restructure, and externalize thinking directly on cards (DESIGN.md $C_{12}$).</p>

    <h4>üèóÔ∏è Implementation</h4>

    <p><strong>1. Add editing mode to CardNode.tsx</strong></p>
    <div class="code-block">
export const CardNode = memo(({ data }: CardNodeProps) => {
  const [isEditing, setIsEditing] = useState(false);
  const [editedContent, setEditedContent] = useState(data.card.content);
  const contentRef = useRef&lt;HTMLDivElement&gt;(null);

  const handleDoubleClick = (e: React.MouseEvent) => {
    if (e.detail === 2) { // Double click
      e.stopPropagation(); // Don't trigger node drag
      setIsEditing(true);
    }
  };

  const handleSave = async () => {
    await updateCardContent(data.card.id, editedContent);
    setIsEditing(false);
  };

  const handleCancel = () => {
    setEditedContent(data.card.content);
    setIsEditing(false);
  };

  return (
    &lt;div onDoubleClick={handleDoubleClick}&gt;
      {isEditing ? (
        &lt;div contentEditable
             ref={contentRef}
             dangerouslySetInnerHTML={{ __html: editedContent }}
             onBlur={handleSave}
             onInput={(e) =&gt; setEditedContent(e.currentTarget.innerHTML)}
             style={{ minHeight: '200px', outline: 'none' }}
        /&gt;
      ) : (
        &lt;div dangerouslySetInnerHTML={{ __html: sanitizedContent }} /&gt;
      )}
    &lt;/div&gt;
  );
});
    </div>

    <p><strong>2. Version history tracking</strong></p>
    <div class="code-block">
interface Card {
  // ... existing fields
  versions?: CardVersion[];
  currentVersionId?: string;
}

interface CardVersion {
  versionId: string;
  content: string;
  timestamp: number;
  editedBy: 'user' | 'ai';
}

// Store versions in chrome.storage.local
async function updateCardContent(
  cardId: string,
  newContent: string
): Promise&lt;void&gt; {
  const card = await getCardById(cardId);

  // Save current version
  const newVersion: CardVersion = {
    versionId: generateId(),
    content: card.content,
    timestamp: Date.now(),
    editedBy: 'user'
  };

  card.versions = card.versions || [];
  card.versions.push(newVersion);
  card.content = newContent;
  card.updatedAt = Date.now();

  await saveCard(card);
}
    </div>

    <h4>‚ú® UX Features</h4>
    <ul>
      <li>Double-click anywhere on card to enter edit mode</li>
      <li>Visual indicator (gold border glow) when in edit mode</li>
      <li>Click outside or press Esc to save and exit</li>
      <li>Toolbar with: Bold, Italic, Highlight, Undo</li>
      <li>"History" button shows version timeline</li>
      <li>Support Markdown shortcuts (## for headers, - for lists)</li>
    </ul>

    <h4>‚ö†Ô∏è Technical Considerations</h4>
    <ul>
      <li>Sanitize edited content before saving (DOMPurify)</li>
      <li>Prevent editing during drag operations</li>
      <li>Debounce autosave to avoid storage thrashing</li>
      <li>Consider collaborative editing conflicts (future)</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 1.3: Create Custom Note Cards</h3>
  <span class="priority p1">P1</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p><span class="benefit">Universal Artifact Substrate:</span> Treat notes and clippings as same data structure (DESIGN.md $C_{10}$, $D_{10}$).</p>

    <h4>üèóÔ∏è Implementation</h4>

    <p><strong>1. Add "New Note" button to Canvas toolbar</strong></p>
    <div class="code-block">
// In Toolbar.tsx
&lt;button
  onClick={handleCreateNote}
  style={newNoteButtonStyles}
  title="Create blank note (Cmd+N)"
&gt;
  ‚úèÔ∏è New Note
&lt;/button&gt;

async function handleCreateNote() {
  const newNote: Card = {
    id: generateId(),
    content: '&lt;p&gt;Start typing...&lt;/p&gt;',
    cardType: 'note',
    metadata: {
      url: '',
      title: 'Untitled Note',
      domain: 'notes',
      favicon: 'üìù',
      timestamp: Date.now()
    },
    position: calculateCenterPosition(), // Center of viewport
    starred: false,
    tags: ['note'],
    createdAt: Date.now(),
    updatedAt: Date.now(),
    conversation: []
  };

  await saveCard(newNote);

  // Auto-enter edit mode
  setTimeout(() => setEditingCardId(newNote.id), 100);
}
    </div>

    <p><strong>2. Keyboard shortcut: Cmd/Ctrl+N</strong></p>
    <div class="code-block">
// In keyboardShortcuts.ts
{
  id: 'createNote',
  key: 'n',
  metaKey: true,
  description: 'Create new note',
  handler: createNewNote
}
    </div>

    <p><strong>3. Note templates (future enhancement)</strong></p>
    <div class="code-block">
const NOTE_TEMPLATES = {
  blank: { content: '&lt;p&gt;&lt;/p&gt;', tags: ['note'] },
  todo: {
    content: '&lt;h2&gt;Todo&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;[ ] &lt;/li&gt;&lt;/ul&gt;',
    tags: ['note', 'todo']
  },
  meeting: {
    content: `&lt;h2&gt;Meeting Notes&lt;/h2&gt;
              &lt;p&gt;&lt;strong&gt;Date:&lt;/strong&gt; ${new Date().toLocaleDateString()}&lt;/p&gt;
              &lt;h3&gt;Attendees&lt;/h3&gt;
              &lt;h3&gt;Discussion&lt;/h3&gt;
              &lt;h3&gt;Action Items&lt;/h3&gt;`,
    tags: ['note', 'meeting']
  },
  research: {
    content: `&lt;h2&gt;Research Notes&lt;/h2&gt;
              &lt;h3&gt;Question&lt;/h3&gt;
              &lt;h3&gt;Findings&lt;/h3&gt;
              &lt;h3&gt;Sources&lt;/h3&gt;`,
    tags: ['note', 'research']
  }
};
    </div>

    <h4>‚ú® UX Features</h4>
    <ul>
      <li>Click "New Note" or press Cmd+N to create</li>
      <li>Note appears centered in current viewport</li>
      <li>Automatically enters edit mode</li>
      <li>Placeholder text: "Start typing..."</li>
      <li>Different icon (üìù) and styling from clipped cards</li>
      <li>Right-click note ‚Üí "Convert to template"</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 1.4: Connect Cards with Arrows (React Flow Edges)</h3>
  <span class="priority p1">P1</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p><span class="benefit">Non-linear Knowledge Construction:</span> Visual relationships show how understanding emerges through connections (DESIGN.md $D_{11}$).</p>

    <h4>üèóÔ∏è Implementation</h4>

    <p><strong>1. Extend Card type to store edges</strong></p>
    <div class="code-block">
interface CardConnection {
  id: string;
  source: string; // Card ID
  target: string; // Card ID
  type: 'generated-from' | 'references' | 'related' | 'contradicts' | 'custom';
  label?: string;
  metadata?: {
    createdAt: number;
    createdBy: 'user' | 'ai';
    note?: string;
  };
}

// Store in chrome.storage.local
const CONNECTIONS_KEY = 'card_connections';
    </div>

    <p><strong>2. Add edge creation UI to Canvas</strong></p>
    <div class="code-block">
// In Canvas.tsx
const [connectionMode, setConnectionMode] = useState(false);
const [selectedSource, setSelectedSource] = useState&lt;string | null&gt;(null);

function handleNodeClick(nodeId: string) {
  if (!connectionMode) return;

  if (!selectedSource) {
    setSelectedSource(nodeId);
  } else {
    // Create connection
    createConnection(selectedSource, nodeId, 'related');
    setSelectedSource(null);
    setConnectionMode(false);
  }
}

async function createConnection(
  source: string,
  target: string,
  type: string
) {
  const connection: CardConnection = {
    id: generateId(),
    source,
    target,
    type,
    metadata: {
      createdAt: Date.now(),
      createdBy: 'user'
    }
  };

  // Save to storage
  const result = await chrome.storage.local.get(CONNECTIONS_KEY);
  const connections = result[CONNECTIONS_KEY] || [];
  connections.push(connection);
  await chrome.storage.local.set({ [CONNECTIONS_KEY]: connections });

  // Update edges state
  setEdges(prev =&gt; [...prev, connectionToEdge(connection)]);
}

function connectionToEdge(conn: CardConnection): Edge {
  return {
    id: conn.id,
    source: conn.source,
    target: conn.target,
    type: 'smoothstep',
    label: conn.label,
    style: getEdgeStyle(conn.type),
    animated: conn.type === 'generated-from'
  };
}

function getEdgeStyle(type: string) {
  const styles = {
    'generated-from': { stroke: '#D4AF37', strokeWidth: 2 },
    'references': { stroke: '#8B7355', strokeWidth: 1, strokeDasharray: '5,5' },
    'related': { stroke: '#B89C82', strokeWidth: 1 },
    'contradicts': { stroke: '#8B0000', strokeWidth: 2 },
  };
  return styles[type] || styles.related;
}
    </div>

    <p><strong>3. Keyboard shortcut: Press 'C' to enter connection mode</strong></p>
    <div class="code-block">
// In keyboardShortcuts.ts
{
  id: 'connectCards',
  key: 'c',
  description: 'Connect two cards with arrow',
  handler: () =&gt; {
    setConnectionMode(true);
    showFeedback('Connection mode: Click source card, then target card');
  }
}
    </div>

    <h4>‚ú® UX Features</h4>
    <ul>
      <li>Toolbar button: "üîó Connect" toggles connection mode</li>
      <li>Connection mode: Cards highlight on hover, cursor changes to crosshair</li>
      <li>Click source card ‚Üí click target card ‚Üí connection created</li>
      <li>Right-click edge ‚Üí Edit label / Change type / Delete</li>
      <li>Edge types with different visual styles:
        <ul>
          <li><strong>Generated from:</strong> Animated gold arrow</li>
          <li><strong>References:</strong> Dashed brown line</li>
          <li><strong>Related:</strong> Solid beige line</li>
          <li><strong>Contradicts:</strong> Bold red line</li>
        </ul>
      </li>
      <li>Double-click edge to add label/note</li>
      <li>Edges saved to storage and persist across sessions</li>
    </ul>

    <h4>‚ö†Ô∏è Technical Considerations</h4>
    <ul>
      <li>Load edges from storage on canvas mount</li>
      <li>Update useCanvasState.ts to manage edges (line 44 currently empty)</li>
      <li>Handle edge deletion when cards are deleted</li>
      <li>Consider bidirectional vs. unidirectional arrows</li>
    </ul>
  </div>
</div>

<hr>

<h2>üöÄ Phase 2: Advanced Features (Identified from Code Analysis)</h2>
<p><span class="priority p2">P2</span> Building on foundation to enable distributed cognition</p>

<div class="epic">
  <h3>Feature 2.1: File & Image Artifacts</h3>
  <span class="priority p2">P2</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Drag-and-drop files/images onto canvas to create first-class artifacts (inspired by tldraw, DESIGN.md Phase 2).</p>

    <h4>üèóÔ∏è Implementation</h4>
    <ul>
      <li>Extend Card type: <code>fileData?: { fileName, fileType, fileSize, fileUrl }</code></li>
      <li>Store files in IndexedDB (reuse screenshot storage pattern)</li>
      <li>Support: Images (inline preview), PDFs (first page preview), Documents (text extraction)</li>
      <li>Drag-drop zone on canvas background</li>
    </ul>

    <div class="code-block">
// In Canvas.tsx
const { dragAndDropHooks } = useDragAndDrop({
  acceptedDragTypes: ['image/*', 'application/pdf', 'text/*'],
  async onRootDrop(e) {
    const items = await Promise.all(
      e.items.filter(isFileDropItem).map(async item =&gt; ({
        file: await item.getFile(),
        name: item.name,
        type: item.type
      }))
    );

    items.forEach(async ({ file, name, type }) =&gt; {
      const fileCard = await createFileCard(file, name, type);
      await saveCard(fileCard);
    });
  }
});
    </div>
  </div>
</div>

<div class="epic">
  <h3>Feature 2.2: Card Search & Quick Jump</h3>
  <span class="priority p2">P2</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Cmd+K command palette for instant card navigation and actions.</p>

    <h4>‚ú® UX Features</h4>
    <ul>
      <li>Cmd+K opens fuzzy search modal</li>
      <li>Search by title, content, tags, domain</li>
      <li>Actions: "Jump to", "Open in window", "Connect to", "Delete"</li>
      <li>Recent cards + most connected cards at top</li>
      <li>Type "/" to filter by card type (notes, clipped, generated)</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 2.3: Smart Auto-Connect</h3>
  <span class="priority p2">P2</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>AI suggests connections between related cards based on content similarity.</p>

    <h4>üèóÔ∏è Implementation</h4>
    <ul>
      <li>Analyze card content for keywords, entities, concepts</li>
      <li>Show "Suggested connections" badge on cards</li>
      <li>Click to review suggestions and approve/reject</li>
      <li>Uses mock Claude API to generate suggestions</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 2.4: Bulk Card Operations</h3>
  <span class="priority p2">P2</span>

  <div class="feature-box">
    <h4>‚ú® UX Features</h4>
    <ul>
      <li>Shift+Click or drag to select multiple cards</li>
      <li>Bulk actions: Tag, Star, Delete, Group, Connect, Export</li>
      <li>Cmd+A selects all visible cards</li>
      <li>Selection toolbar appears when >1 card selected</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 2.5: Card Grouping & Containers</h3>
  <span class="priority p2">P2</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Visual containers to organize related cards (like Figma frames).</p>

    <h4>‚ú® UX Features</h4>
    <ul>
      <li>Draw rectangle on canvas to create group</li>
      <li>Cards inside move together when group is dragged</li>
      <li>Group label, color, and collapse/expand</li>
      <li>Nested groups supported</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 2.6: Export & Sharing</h3>
  <span class="priority p2">P2</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Share canvas or individual cards as portable artifacts.</p>

    <h4>‚ú® Export Formats</h4>
    <ul>
      <li><strong>JSON:</strong> Full card data + connections (import/export)</li>
      <li><strong>Markdown:</strong> Hierarchical outline view</li>
      <li><strong>HTML:</strong> Static website with all content</li>
      <li><strong>Image:</strong> Canvas screenshot (via React Flow export)</li>
      <li><strong>PDF:</strong> Multi-page document with cards + connections</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 2.7: Timeline & History View</h3>
  <span class="priority p2">P2</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Visualize evolution of understanding over time.</p>

    <h4>‚ú® UX Features</h4>
    <ul>
      <li>Timeline slider at bottom of canvas</li>
      <li>Drag slider to see canvas at different points in time</li>
      <li>Cards fade in/out based on creation/deletion time</li>
      <li>"Replay" mode shows how canvas evolved</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 2.8: Card Templates & Snippets</h3>
  <span class="priority p2">P2</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Reusable structures for common workflows.</p>

    <h4>‚ú® Templates</h4>
    <ul>
      <li><strong>Research Note:</strong> Question / Findings / Sources</li>
      <li><strong>Meeting:</strong> Attendees / Discussion / Action Items</li>
      <li><strong>Literature Review:</strong> Paper / Summary / Key Points / Critiques</li>
      <li><strong>Project:</strong> Goal / Tasks / Resources / Timeline</li>
      <li>User can save any card as template</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 2.9: Minimap Card Previews</h3>
  <span class="priority p2">P2</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Enhanced minimap shows card thumbnails instead of boxes.</p>

    <h4>üèóÔ∏è Implementation</h4>
    <ul>
      <li>Capture card content as thumbnail (via html2canvas)</li>
      <li>Show in minimap on hover</li>
      <li>Click minimap card to jump to it</li>
    </ul>
  </div>
</div>

<div class="epic">
  <h3>Feature 2.10: Card Annotations & Highlights</h3>
  <span class="priority p2">P2</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Markup cards with highlights, comments, and sticky notes.</p>

    <h4>‚ú® UX Features</h4>
    <ul>
      <li>Select text ‚Üí Highlight button ‚Üí Choose color</li>
      <li>Right-click text ‚Üí "Add comment"</li>
      <li>Comments stored as <code>card.annotations[]</code></li>
      <li>Filter: "Show only highlighted cards"</li>
    </ul>
  </div>
</div>

<hr>

<h2>üîÆ Phase 3: Distributed Cognition (Long-term Vision)</h2>
<p><span class="priority p3">P3</span> Advanced features from DESIGN.md</p>

<div class="epic">
  <h3>Feature 3.1: Inter-Artifact Communication</h3>
  <span class="priority p3">P3</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Cards can query each other via <code>&lt;artifact-ref&gt;</code> elements (DESIGN.md Phase 5).</p>

    <h4>Example Workflow</h4>
    <ol>
      <li>Card A contains research question</li>
      <li>Insert <code>&lt;artifact-ref target="card-B" query="What does this say about X?"&gt;</code></li>
      <li>Background worker routes query to Claude</li>
      <li>Claude reads Card B, generates response</li>
      <li>Response injected into Card A via CardMutationAPI</li>
    </ol>
  </div>
</div>

<div class="epic">
  <h3>Feature 3.2: Generative UI / Learn-More Buttons</h3>
  <span class="priority p3">P3</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Cards contain <code>&lt;learn-more&gt;</code> elements that spawn new artifacts on demand (DESIGN.md Phase 3).</p>

    <h4>Example</h4>
    <p>Card contains: <code>&lt;learn-more topic="distributed cognition" context="card-id"&gt;Learn More&lt;/learn-more&gt;</code></p>
    <p>User clicks ‚Üí Claude generates new card with expanded information ‚Üí Card appears on canvas with connection arrow.</p>
  </div>
</div>

<div class="epic">
  <h3>Feature 3.3: CardMutationAPI (AI-as-Backend)</h3>
  <span class="priority p3">P3</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Claude can manipulate card DOM post-creation through surgical edits (inspired by Claude Imagine).</p>

    <h4>API Methods</h4>
    <ul>
      <li><code>replaceContent(selector, html)</code></li>
      <li><code>appendSection(html)</code></li>
      <li><code>highlight(text, note)</code></li>
      <li><code>collapse(selector)</code></li>
      <li><code>injectReference(sourceArtifactId, excerpt)</code></li>
    </ul>

    <p>See DESIGN.md Phase 1.5 for full specification.</p>
  </div>
</div>

<div class="epic">
  <h3>Feature 3.4: Version History & Parallel Documents</h3>
  <span class="priority p3">P3</span>

  <div class="feature-box">
    <h4>üéØ Goal</h4>
    <p>Ted Nelson-inspired features for tracking evolution (DESIGN.md Future Features).</p>

    <h4>Features</h4>
    <ul>
      <li><strong>Version tracking:</strong> Full history of all edits with links between versions</li>
      <li><strong>Parallel view:</strong> Two cards side-by-side with visual connection lines</li>
      <li><strong>Merge/split:</strong> Combine related cards, preserve ability to unmerge</li>
    </ul>
  </div>
</div>

<hr>

<h2>üìä Implementation Priority Matrix</h2>

<table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>Priority</th>
      <th>Effort</th>
      <th>Impact</th>
      <th>Dependencies</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1.1 Persist Chat as Cards</td>
      <td><span class="priority p1">P1</span></td>
      <td>Medium</td>
      <td>High</td>
      <td>None</td>
    </tr>
    <tr>
      <td>1.2 Inline Editing</td>
      <td><span class="priority p1">P1</span></td>
      <td>Medium</td>
      <td>High</td>
      <td>None</td>
    </tr>
    <tr>
      <td>1.3 Custom Notes</td>
      <td><span class="priority p1">P1</span></td>
      <td>Small</td>
      <td>High</td>
      <td>1.2 (editing)</td>
    </tr>
    <tr>
      <td>1.4 Card Connections</td>
      <td><span class="priority p1">P1</span></td>
      <td>Medium</td>
      <td>High</td>
      <td>None</td>
    </tr>
    <tr>
      <td>2.1 File Artifacts</td>
      <td><span class="priority p2">P2</span></td>
      <td>Large</td>
      <td>Medium</td>
      <td>None</td>
    </tr>
    <tr>
      <td>2.2 Card Search</td>
      <td><span class="priority p2">P2</span></td>
      <td>Medium</td>
      <td>High</td>
      <td>None</td>
    </tr>
    <tr>
      <td>2.3 Auto-Connect</td>
      <td><span class="priority p2">P2</span></td>
      <td>Large</td>
      <td>Medium</td>
      <td>1.4 (connections)</td>
    </tr>
    <tr>
      <td>2.4 Bulk Operations</td>
      <td><span class="priority p2">P2</span></td>
      <td>Medium</td>
      <td>Medium</td>
      <td>None</td>
    </tr>
    <tr>
      <td>2.5 Card Grouping</td>
      <td><span class="priority p2">P2</span></td>
      <td>Large</td>
      <td>Medium</td>
      <td>None</td>
    </tr>
    <tr>
      <td>2.6 Export/Sharing</td>
      <td><span class="priority p2">P2</span></td>
      <td>Medium</td>
      <td>Low</td>
      <td>None</td>
    </tr>
    <tr>
      <td>3.1 Inter-Artifact Comm</td>
      <td><span class="priority p3">P3</span></td>
      <td>X-Large</td>
      <td>High</td>
      <td>3.3 (CardMutationAPI)</td>
    </tr>
    <tr>
      <td>3.2 Generative UI</td>
      <td><span class="priority p3">P3</span></td>
      <td>X-Large</td>
      <td>High</td>
      <td>3.3 (CardMutationAPI)</td>
    </tr>
    <tr>
      <td>3.3 CardMutationAPI</td>
      <td><span class="priority p3">P3</span></td>
      <td>X-Large</td>
      <td>High</td>
      <td>Real Claude API</td>
    </tr>
  </tbody>
</table>

<hr>

<h2>üéØ Recommended Implementation Order</h2>

<div class="phase">
  <h3>Sprint 1: Foundation (2-3 weeks)</h3>
  <ol>
    <li><strong>1.3 Custom Notes</strong> - Simplest P1, enables testing editing UX</li>
    <li><strong>1.2 Inline Editing</strong> - Core infrastructure, needed for notes</li>
    <li><strong>1.4 Card Connections</strong> - Update useCanvasState edges, create connection UI</li>
  </ol>
</div>

<div class="phase">
  <h3>Sprint 2: Output as Input (2-3 weeks)</h3>
  <ol>
    <li><strong>1.1 Persist Chat as Cards</strong> - Completes Phase 1 user requests</li>
    <li><strong>2.2 Card Search (Cmd+K)</strong> - Navigation critical as cards grow</li>
    <li><strong>2.4 Bulk Operations</strong> - Productivity multiplier</li>
  </ol>
</div>

<div class="phase">
  <h3>Sprint 3: Advanced Features (3-4 weeks)</h3>
  <ol>
    <li><strong>2.1 File Artifacts</strong> - Expand universal substrate</li>
    <li><strong>2.10 Annotations</strong> - Externalize thinking</li>
    <li><strong>2.6 Export/Sharing</strong> - Make work portable</li>
  </ol>
</div>

<div class="phase">
  <h3>Future: Distributed Cognition (Long-term)</h3>
  <ul>
    <li>Requires real Claude API integration</li>
    <li>Background worker routing for inter-artifact communication</li>
    <li>CardMutationAPI for post-creation manipulation</li>
    <li>Generative UI exploration</li>
  </ul>
</div>

<hr>

<h2>üîç Additional Cool Features Identified</h2>

<div class="feature-box">
  <h3>From Code Analysis</h3>
  <ol>
    <li><strong>Backlinks:</strong> Show which cards reference/connect to current card</li>
    <li><strong>Card Duplication:</strong> Right-click ‚Üí Duplicate to create copy</li>
    <li><strong>Pin to Top:</strong> Keep important cards always visible in viewport</li>
    <li><strong>Card Colors:</strong> User-assigned colors for visual organization</li>
    <li><strong>Screenshot Viewer:</strong> Cards with screenshots show preview (already stored in IndexedDB!)</li>
    <li><strong>Graph View:</strong> Alternative visualization showing only connections</li>
    <li><strong>Breadcrumbs:</strong> Show path through connected cards</li>
    <li><strong>Smart Tags:</strong> AI auto-suggests tags based on content</li>
    <li><strong>Related Cards Sidebar:</strong> Show similar cards while viewing one</li>
    <li><strong>Presentation Mode:</strong> Full-screen slideshow through connected cards</li>
    <li><strong>Card Statistics:</strong> Word count, reading time, conversation turns</li>
    <li><strong>Keyboard Navigation:</strong> Arrow keys to navigate between connected cards</li>
    <li><strong>Card Locking:</strong> Prevent accidental edits/moves</li>
    <li><strong>Undo/Redo:</strong> Canvas-level history for all operations</li>
    <li><strong>Collaborative Cursors:</strong> See where others are looking (future multi-user)</li>
  </ol>
</div>

<hr>

<h2>üìù Summary</h2>

<div class="insight">
  <strong>Key Insights:</strong>
  <ul>
    <li><strong>React Flow edges are ready:</strong> Just need to populate the empty edges array and create UI for connections</li>
    <li><strong>Editing is straightforward:</strong> ContentEditable + DOMPurify + version history</li>
    <li><strong>Notes are easy:</strong> Same Card structure, different metadata</li>
    <li><strong>"Output as input" unlocks distributed cognition:</strong> Saving chat responses as cards enables networked thinking</li>
    <li><strong>Phase 1 features are all achievable in 4-6 weeks:</strong> No major architectural changes needed</li>
    <li><strong>Phases 2-3 build naturally:</strong> Each feature extends the artifact substrate</li>
  </ul>
</div>

<div class="architecture-note">
  <strong>üèóÔ∏è Architecture Notes:</strong>
  <ul>
    <li><strong>Storage:</strong> Continue using chrome.storage.local for cards, add separate key for connections</li>
    <li><strong>Card Types:</strong> Add <code>cardType</code> field to distinguish clipped/generated/note cards</li>
    <li><strong>Edges:</strong> Store separately from cards to enable efficient querying</li>
    <li><strong>Version History:</strong> Store in card.versions array, consider size limits</li>
    <li><strong>Editing:</strong> Sanitize all user input, debounce autosaves</li>
  </ul>
</div>

<p><strong>Total Estimated Effort:</strong></p>
<ul>
  <li>Phase 1 (P1 features): 4-6 weeks</li>
  <li>Phase 2 (P2 features): 6-8 weeks</li>
  <li>Phase 3 (P3 features): 12-16 weeks (requires real Claude API)</li>
</ul>

<p><strong>Highest Impact Quick Wins:</strong></p>
<ol>
  <li>Custom Notes (1-2 days) - immediately useful</li>
  <li>Card Connections (3-4 days) - visual relationships</li>
  <li>Inline Editing (5-7 days) - direct manipulation</li>
  <li>Cmd+K Search (3-4 days) - navigation at scale</li>
</ol>

<hr>

<p style="text-align: center; color: #8B7355; font-style: italic; margin-top: 60px;">
  Generated with Claude Code | Plan Version 1.0 | October 2025
</p>

</body>
</html>
