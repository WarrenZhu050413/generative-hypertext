<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Drop Architecture - Nabokov Web Clipper</title>
    <style>
        :root {
            --chinese-red: #8B0000;
            --chinese-gold: #FFD700;
            --ink-black: #1a1a1a;
            --paper-beige: #F5F5DC;
            --light-cream: #FFFEF0;
            --level-1: #8B0000;
            --level-2: #CD5C5C;
            --level-3: #666;
            --level-4: #999;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, var(--paper-beige) 0%, var(--light-cream) 100%);
            color: var(--ink-black);
            margin: 0;
            padding: 12px;
            width: 100vw;
            max-width: 100%;
            line-height: 1.3;
            font-size: 14px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .container {
            width: 100%;
            padding: 0;
            margin: 0;
        }

        h1 {
            font-size: 28px;
            font-weight: 900;
            margin: 8px 0 16px 0;
            padding: 12px 8px;
            background: linear-gradient(135deg, var(--chinese-red), #CD5C5C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
            border-bottom: 3px solid var(--chinese-gold);
        }

        h2 {
            font-size: 20px;
            font-weight: 700;
            margin: 16px 0 8px 0;
            padding: 8px;
            border-left: 4px solid var(--chinese-red);
            background: rgba(139, 0, 0, 0.05);
            color: var(--level-1);
        }

        h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 12px 0 6px 8px;
            color: var(--level-2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        h4 {
            font-size: 14px;
            font-weight: 600;
            margin: 8px 0 4px 16px;
            color: var(--level-2);
        }

        .important-always-visible {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), white);
            border: 3px solid var(--chinese-gold);
            padding: 16px;
            margin: 16px 0;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(139, 0, 0, 0.1);
        }

        .two-column-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 12px 0;
        }

        .column {
            background: white;
            border: 1px solid rgba(139, 0, 0, 0.2);
            border-radius: 4px;
            padding: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .full-width {
            grid-column: span 2;
        }

        .collapsible {
            margin: 8px 0;
            width: 100%;
        }

        .collapsible-header {
            cursor: pointer;
            padding: 10px 12px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.08), rgba(255, 215, 0, 0.05));
            border-left: 3px solid var(--chinese-gold);
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
            transition: all 0.2s ease;
            border-radius: 2px;
            font-weight: 600;
        }

        .collapsible-header:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.12), rgba(255, 215, 0, 0.08));
        }

        .collapsible-header .arrow {
            display: inline-block;
            transition: transform 0.3s ease;
            color: var(--chinese-red);
            font-size: 12px;
            margin-right: 8px;
        }

        .collapsible.open .arrow {
            transform: rotate(90deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0 12px;
            margin-left: 8px;
        }

        .collapsible.open .collapsible-content {
            max-height: 5000px;
            padding: 12px;
        }

        .collapsible.critical .collapsible-header {
            border-left: 4px solid var(--chinese-red);
            background: rgba(139, 0, 0, 0.1);
            font-weight: 700;
        }

        pre, code {
            background: linear-gradient(135deg, rgba(245, 245, 220, 0.4), rgba(255, 255, 255, 0.6));
            border: 1px solid rgba(139, 0, 0, 0.15);
            padding: 3px 6px;
            margin: 2px 0;
            font-size: 13px;
            line-height: 1.4;
            font-family: "SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, monospace;
            border-radius: 2px;
        }

        pre {
            padding: 12px;
            margin: 8px 0;
            overflow-x: auto;
            border-left: 3px solid var(--chinese-gold);
        }

        .flow-diagram {
            background: white;
            border: 2px solid var(--chinese-red);
            padding: 16px;
            margin: 12px 0;
            border-radius: 4px;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: rgba(139, 0, 0, 0.03);
            border-left: 3px solid var(--chinese-gold);
        }

        .flow-arrow {
            text-align: center;
            color: var(--chinese-red);
            font-size: 20px;
            margin: 4px 0;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            margin: 0 4px;
        }

        .badge-canvas {
            background: rgba(255, 0, 0, 0.1);
            color: #8B0000;
            border: 1px solid rgba(139, 0, 0, 0.3);
        }

        .badge-sidepanel {
            background: rgba(0, 0, 255, 0.1);
            color: #00008B;
            border: 1px solid rgba(0, 0, 139, 0.3);
        }

        .badge-shared {
            background: rgba(255, 215, 0, 0.2);
            color: #8B4513;
            border: 1px solid rgba(139, 69, 19, 0.4);
        }

        ul {
            margin-left: 24px;
            margin-top: 8px;
        }

        li {
            margin: 4px 0;
            line-height: 1.5;
        }

        strong {
            color: var(--level-1);
            font-weight: 600;
        }

        .file-path {
            color: var(--chinese-red);
            font-family: "SF Mono", Monaco, monospace;
            font-size: 12px;
            background: rgba(139, 0, 0, 0.05);
            padding: 1px 4px;
            border-radius: 2px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 13px;
            background: white;
        }

        th, td {
            border: 1px solid rgba(139, 0, 0, 0.2);
            padding: 8px 12px;
            text-align: left;
            line-height: 1.4;
        }

        th {
            background: rgba(139, 0, 0, 0.1);
            font-weight: 700;
            color: var(--level-1);
        }

        .divider {
            height: 2px;
            background: linear-gradient(90deg, var(--chinese-red), transparent);
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üñºÔ∏è Image Drop Architecture - Nabokov Web Clipper</h1>

        <div class="important-always-visible">
            <h2>üéØ Core Architecture Summary</h2>
            <p><strong>Both Canvas and Side Panel use a unified shared architecture</strong> for image handling. The system has three layers:</p>
            <ul>
                <li><strong>Shared Services:</strong> <span class="file-path">src/shared/services/imageService.ts</span> - Core image processing logic</li>
                <li><strong>Shared Hooks:</strong> <span class="file-path">src/shared/hooks/useImageUpload.ts</span> - Reusable React hook for image upload</li>
                <li><strong>Shared Components:</strong> <span class="file-path">src/shared/components/ImageUpload/</span> - UI components (drag-drop zone + file picker)</li>
            </ul>
            <p style="margin-top: 12px;"><strong>Key Insight:</strong> Canvas and Side Panel both use the <em>exact same code</em> for image handling, ensuring consistency and eliminating duplication.</p>
        </div>

        <h2>üìä High-Level Data Flow</h2>
        <div class="flow-diagram">
            <div class="flow-step">
                <strong>1. User Action:</strong> Drags image file OR clicks file picker button
            </div>
            <div class="flow-arrow">‚Üì</div>
            <div class="flow-step">
                <strong>2. Event Handler:</strong> <code>ImageUploadZone</code> or <code>FilePickerButton</code> receives file
            </div>
            <div class="flow-arrow">‚Üì</div>
            <div class="flow-step">
                <strong>3. Validation:</strong> <code>imageService.validateImageFile()</code> checks MIME type + size
            </div>
            <div class="flow-arrow">‚Üì</div>
            <div class="flow-step">
                <strong>4. Conversion:</strong> <code>imageService.fileToDataURL()</code> converts to base64
            </div>
            <div class="flow-arrow">‚Üì</div>
            <div class="flow-step">
                <strong>5. Dimension Extraction:</strong> <code>imageService.getImageDimensions()</code> reads width/height
            </div>
            <div class="flow-arrow">‚Üì</div>
            <div class="flow-step">
                <strong>6. Card Creation:</strong> <code>cardService.createCard()</code> saves to chrome.storage.local
            </div>
            <div class="flow-arrow">‚Üì</div>
            <div class="flow-step">
                <strong>7. Broadcast Update:</strong> Local event + runtime message notify all contexts
            </div>
            <div class="flow-arrow">‚Üì</div>
            <div class="flow-step">
                <strong>8. UI Update:</strong> Canvas/Side Panel refreshes to show new card
            </div>
        </div>

        <div class="divider"></div>

        <h2>üèóÔ∏è Architecture Layers</h2>

        <div class="two-column-layout">
            <div class="column">
                <h3><span class="badge badge-canvas">Canvas</span> Implementation</h3>
                <h4>Components Used:</h4>
                <ul>
                    <li><code>ImageUploadZone</code> - Drag & drop overlay</li>
                    <li><code>FilePickerButton</code> - Toolbar button</li>
                </ul>
                <h4>Location:</h4>
                <p><span class="file-path">src/canvas/Canvas.tsx</span></p>
                <h4>Behavior:</h4>
                <ul>
                    <li>Full-screen drop zone overlay appears on drag</li>
                    <li>File picker button in toolbar</li>
                    <li>Creates cards with <code>stashed: false</code></li>
                    <li>Cards appear immediately on canvas</li>
                </ul>
            </div>

            <div class="column">
                <h3><span class="badge badge-sidepanel">Side Panel</span> Implementation</h3>
                <h4>Components Used:</h4>
                <ul>
                    <li><code>ImageUploadZone</code> - Drag & drop overlay</li>
                    <li><code>FilePickerButton</code> - Header button</li>
                </ul>
                <h4>Location:</h4>
                <p><span class="file-path">src/sidepanel/SidePanel.tsx</span></p>
                <h4>Behavior:</h4>
                <ul>
                    <li>Compact drop zone in side panel</li>
                    <li>File picker button in header</li>
                    <li>Creates cards with <code>stashed: true</code></li>
                    <li>Cards appear in stash immediately</li>
                </ul>
            </div>
        </div>

        <div class="collapsible critical">
            <div class="collapsible-header">
                <span><span class="arrow">‚ñ∂</span><strong>Shared Services Layer</strong> - Core Image Processing Logic</span>
            </div>
            <div class="collapsible-content">
                <h3>üìÅ <span class="file-path">src/shared/services/imageService.ts</span></h3>
                <p><strong>Purpose:</strong> Centralized image processing with validation, conversion, and dimension extraction.</p>

                <h4>Key Functions:</h4>
                <table>
                    <tr>
                        <th>Function</th>
                        <th>Purpose</th>
                        <th>Returns</th>
                    </tr>
                    <tr>
                        <td><code>validateImageFile(file)</code></td>
                        <td>Validates MIME type is <code>image/*</code></td>
                        <td><code>{valid: boolean, error?: string}</code></td>
                    </tr>
                    <tr>
                        <td><code>fileToDataURL(file)</code></td>
                        <td>Converts File to base64 data URL</td>
                        <td><code>Promise&lt;string&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>getImageDimensions(dataURL)</code></td>
                        <td>Extracts width/height from data URL</td>
                        <td><code>Promise&lt;{width, height}&gt;</code></td>
                    </tr>
                    <tr>
                        <td><code>processImageFile(file)</code></td>
                        <td>All-in-one: validate + convert + extract dimensions</td>
                        <td><code>Promise&lt;ImageData&gt;</code></td>
                    </tr>
                </table>

                <h4>Example Usage:</h4>
                <pre><code>import { imageService } from '@/shared/services/imageService';

// Process a file
const result = await imageService.processImageFile(file);
if (result.valid) {
  console.log(result.dataURL);        // "data:image/png;base64,..."
  console.log(result.dimensions);     // { width: 800, height: 600 }
} else {
  console.error(result.error);        // "Invalid file type"
}</code></pre>

                <h4>Error Handling:</h4>
                <ul>
                    <li><strong>Invalid MIME type:</strong> Returns <code>{valid: false, error: "Invalid file type"}</code></li>
                    <li><strong>File read failure:</strong> Rejects promise with error</li>
                    <li><strong>Image load failure:</strong> Rejects promise with error</li>
                </ul>
            </div>
        </div>

        <div class="collapsible critical">
            <div class="collapsible-header">
                <span><span class="arrow">‚ñ∂</span><strong>Shared Hooks Layer</strong> - React Integration</span>
            </div>
            <div class="collapsible-content">
                <h3>ü™ù <span class="file-path">src/shared/hooks/useImageUpload.ts</span></h3>
                <p><strong>Purpose:</strong> Reusable React hook that handles image upload workflow with loading states and error handling.</p>

                <h4>Hook Interface:</h4>
                <pre><code>const {
  handleImageUpload,  // (files: FileList | File[]) => Promise&lt;void&gt;
  isUploading,        // boolean - loading state
  uploadError         // string | null - error message
} = useImageUpload({
  stashed,           // boolean - save to stash or canvas
  onUploadComplete   // () => void - optional callback
});</code></pre>

                <h4>Internal Workflow:</h4>
                <ol>
                    <li>Set <code>isUploading = true</code></li>
                    <li>For each file:
                        <ul>
                            <li>Call <code>imageService.processImageFile(file)</code></li>
                            <li>Extract page metadata (URL, title, favicon)</li>
                            <li>Call <code>cardService.createCard()</code> with image data</li>
                        </ul>
                    </li>
                    <li>Broadcast update via <code>cardService</code></li>
                    <li>Set <code>isUploading = false</code></li>
                    <li>Call <code>onUploadComplete()</code> if provided</li>
                </ol>

                <h4>Example Usage in Canvas:</h4>
                <pre><code>import { useImageUpload } from '@/shared/hooks/useImageUpload';

function Canvas() {
  const { handleImageUpload, isUploading } = useImageUpload({
    stashed: false,  // Save to canvas
    onUploadComplete: () => console.log('Upload done!')
  });

  return (
    &lt;ImageUploadZone onFilesDropped={handleImageUpload} /&gt;
  );
}</code></pre>

                <h4>Example Usage in Side Panel:</h4>
                <pre><code>import { useImageUpload } from '@/shared/hooks/useImageUpload';

function SidePanel() {
  const { handleImageUpload, isUploading } = useImageUpload({
    stashed: true,  // Save to stash
    onUploadComplete: () => console.log('Stashed!')
  });

  return (
    &lt;ImageUploadZone onFilesDropped={handleImageUpload} /&gt;
  );
}</code></pre>
            </div>
        </div>

        <div class="collapsible critical">
            <div class="collapsible-header">
                <span><span class="arrow">‚ñ∂</span><strong>Shared Components Layer</strong> - UI Elements</span>
            </div>
            <div class="collapsible-content">
                <h3>üß© <span class="file-path">src/shared/components/ImageUpload/</span></h3>

                <h4>1. ImageUploadZone.tsx - Drag & Drop Zone</h4>
                <p><strong>Purpose:</strong> Full-screen overlay that appears when user drags files over the window.</p>

                <h4>Props:</h4>
                <table>
                    <tr>
                        <th>Prop</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><code>onFilesDropped</code></td>
                        <td><code>(files: FileList) =&gt; void</code></td>
                        <td>Callback when files are dropped</td>
                    </tr>
                    <tr>
                        <td><code>isUploading</code></td>
                        <td><code>boolean</code></td>
                        <td>Show loading indicator</td>
                    </tr>
                </table>

                <h4>Behavior:</h4>
                <ul>
                    <li><strong>Drag Enter:</strong> Show overlay with visual feedback</li>
                    <li><strong>Drag Over:</strong> Prevent default to allow drop</li>
                    <li><strong>Drag Leave:</strong> Hide overlay</li>
                    <li><strong>Drop:</strong> Call <code>onFilesDropped</code> and hide overlay</li>
                </ul>

                <h4>Visual States:</h4>
                <ul>
                    <li><strong>Hidden:</strong> Not visible when no drag activity</li>
                    <li><strong>Active:</strong> Semi-transparent overlay with "Drop images here" message</li>
                    <li><strong>Uploading:</strong> Loading spinner + "Uploading..." message</li>
                </ul>

                <div class="divider" style="margin: 16px 0;"></div>

                <h4>2. FilePickerButton.tsx - File Input Button</h4>
                <p><strong>Purpose:</strong> Button that opens native file picker dialog.</p>

                <h4>Props:</h4>
                <table>
                    <tr>
                        <th>Prop</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td><code>onFilesSelected</code></td>
                        <td><code>(files: FileList) =&gt; void</code></td>
                        <td>Callback when files are selected</td>
                    </tr>
                    <tr>
                        <td><code>isUploading</code></td>
                        <td><code>boolean</code></td>
                        <td>Disable button during upload</td>
                    </tr>
                    <tr>
                        <td><code>label</code></td>
                        <td><code>string</code></td>
                        <td>Button text (default: "Upload Image")</td>
                    </tr>
                </table>

                <h4>Implementation:</h4>
                <pre><code>&lt;input
  type="file"
  accept="image/*"
  multiple
  style={{ display: 'none' }}
  ref={inputRef}
  onChange={handleFileChange}
/&gt;
&lt;button onClick={() => inputRef.current?.click()}&gt;
  {isUploading ? 'Uploading...' : label}
&lt;/button&gt;</code></pre>

                <h4>Features:</h4>
                <ul>
                    <li>Hidden file input with <code>accept="image/*"</code></li>
                    <li>Supports multiple file selection</li>
                    <li>Disabled state during upload</li>
                    <li>Custom label support</li>
                </ul>
            </div>
        </div>

        <div class="divider"></div>

        <h2>üîÑ Cross-Context Synchronization</h2>
        <div class="important-always-visible">
            <h3>How Canvas and Side Panel Stay in Sync</h3>
            <p>When a card is created via image upload, <strong>both contexts are notified immediately</strong>:</p>

            <h4>Broadcast Mechanism:</h4>
            <pre><code>// In cardService.ts
function broadcastCardUpdate(type: string, cardId: string) {
  // Local event (same context)
  window.dispatchEvent(new CustomEvent('nabokov:cards-updated'));

  // Runtime message (cross-context)
  chrome.runtime.sendMessage({ type, cardId });
}</code></pre>

            <h4>Listeners:</h4>
            <ul>
                <li><strong>Canvas:</strong> <code>useCanvasState.ts</code> listens to both events and reloads cards</li>
                <li><strong>Side Panel:</strong> <code>useCards.ts</code> listens to both events and reloads cards</li>
            </ul>

            <h4>Result:</h4>
            <p>Upload an image in Canvas ‚Üí Side Panel stash updates instantly (if stashed)</p>
            <p>Upload an image in Side Panel ‚Üí Canvas updates instantly (if not stashed)</p>
        </div>

        <div class="divider"></div>

        <h2>üì¶ Card Data Structure for Images</h2>
        <div class="collapsible">
            <div class="collapsible-header">
                <span><span class="arrow">‚ñ∂</span>Card Type Definition</span>
            </div>
            <div class="collapsible-content">
                <pre><code>interface Card {
  id: string;                    // Generated by generateId()
  cardType: "image";             // Identifies this as an image card
  imageData: string;             // Base64 data URL: "data:image/png;base64,..."
  imageDimensions: {             // Original image dimensions
    width: number;               // e.g., 800
    height: number;              // e.g., 600
  };
  content?: string;              // Optional caption/description
  metadata: {                    // Page context where uploaded
    url: string;
    title: string;
    domain: string;
    favicon: string;
    timestamp: number;
  };
  position?: { x: number; y: number };  // Canvas position
  size?: { width: number; height: number };  // Canvas size
  starred: boolean;              // Star state
  tags: string[];                // User tags
  stashed: boolean;              // true = side panel, false = canvas
  createdAt: number;
  updatedAt: number;
}</code></pre>
            </div>
        </div>

        <div class="divider"></div>

        <h2>üß™ Testing Coverage</h2>
        <div class="two-column-layout">
            <div class="column">
                <h3>Unit Tests</h3>
                <h4><span class="file-path">tests/unit/shared/services/imageService.test.ts</span></h4>
                <ul>
                    <li>‚úÖ File validation (21 tests)</li>
                    <li>‚úÖ MIME type checking</li>
                    <li>‚úÖ Base64 conversion</li>
                    <li>‚úÖ Dimension extraction</li>
                    <li>‚úÖ Error handling</li>
                </ul>
                <p><strong>Coverage:</strong> 100% of imageService</p>
            </div>

            <div class="column">
                <h3>E2E Tests</h3>
                <h4><span class="file-path">tests/e2e/phase-1-2-refinements.spec.ts</span></h4>
                <ul>
                    <li>‚úÖ Drag-drop image upload (Canvas)</li>
                    <li>‚úÖ File picker upload (Canvas)</li>
                    <li>‚úÖ Drag-drop image upload (Side Panel)</li>
                    <li>‚úÖ File picker upload (Side Panel)</li>
                    <li>‚úÖ Cross-context synchronization</li>
                </ul>
                <p><strong>Coverage:</strong> Full user workflows</p>
            </div>
        </div>

        <div class="divider"></div>

        <h2>üé® Visual Rendering</h2>
        <div class="collapsible">
            <div class="collapsible-header">
                <span><span class="arrow">‚ñ∂</span>How Image Cards Are Displayed</span>
            </div>
            <div class="collapsible-content">
                <h4>In Canvas (<span class="file-path">src/canvas/CardNode.tsx</span>):</h4>
                <pre><code>{card.cardType === 'image' && card.imageData && (
  &lt;div className="card-image-container"&gt;
    &lt;img
      src={card.imageData}
      alt={card.content || 'Uploaded image'}
      style={{
        maxWidth: '100%',
        maxHeight: '400px',
        objectFit: 'contain'
      }}
    /&gt;
  &lt;/div&gt;
)}</code></pre>

                <h4>In Side Panel (<span class="file-path">src/sidepanel/SidePanel.tsx</span>):</h4>
                <pre><code>{card.cardType === 'image' && card.imageData && (
  &lt;img
    src={card.imageData}
    alt="Stashed image"
    style={{
      maxHeight: '250px',
      objectFit: 'contain',
      width: '100%'
    }}
  /&gt;
)}</code></pre>

                <h4>Key Styling:</h4>
                <ul>
                    <li><code>object-fit: contain</code> - Preserves aspect ratio</li>
                    <li>Max height constraints prevent oversized images</li>
                    <li>Full width in containers for responsive layout</li>
                    <li>Badge indicator: üì∑ Image</li>
                </ul>
            </div>
        </div>

        <div class="divider"></div>

        <h2>‚ö†Ô∏è Known Limitations</h2>
        <div class="collapsible">
            <div class="collapsible-header">
                <span><span class="arrow">‚ñ∂</span>Storage and Browser Constraints</span>
            </div>
            <div class="collapsible-content">
                <h4>Storage Limit:</h4>
                <ul>
                    <li><code>chrome.storage.local</code> has ~5MB limit after JSON serialization</li>
                    <li>Base64 encoding increases size by ~33%</li>
                    <li>Large images (>1MB) can quickly fill storage</li>
                    <li><strong>No current size limit enforcement</strong> - user can exceed quota</li>
                </ul>

                <h4>File Type Support:</h4>
                <ul>
                    <li>‚úÖ Validated: Only <code>image/*</code> MIME types accepted</li>
                    <li>‚úÖ Tested: PNG, JPEG, GIF, WebP, SVG</li>
                    <li>‚ùå Not supported: Video, audio, documents</li>
                </ul>

                <h4>Performance:</h4>
                <ul>
                    <li>Base64 conversion is synchronous but fast (&lt;100ms typical)</li>
                    <li>Dimension extraction requires image load (&lt;200ms typical)</li>
                    <li>Storage write is async but blocks UI briefly</li>
                </ul>

                <h4>Testing Limitations:</h4>
                <ul>
                    <li>‚ùå Playwright cannot simulate real file drag-drop (security restriction)</li>
                    <li>‚ùå Playwright cannot trigger real file picker (security restriction)</li>
                    <li>‚úÖ Tests verify UI presence and programmatic upload</li>
                </ul>
            </div>
        </div>

        <div class="divider"></div>

        <h2>üîß Future Enhancements</h2>
        <div class="collapsible">
            <div class="collapsible-header">
                <span><span class="arrow">‚ñ∂</span>Potential Improvements</span>
            </div>
            <div class="collapsible-content">
                <h4>Storage Optimization:</h4>
                <ul>
                    <li>Implement image compression before storage (reduce base64 size)</li>
                    <li>Add storage quota warnings when approaching 5MB limit</li>
                    <li>Implement thumbnail generation for large images</li>
                    <li>Consider IndexedDB for larger image storage</li>
                </ul>

                <h4>User Experience:</h4>
                <ul>
                    <li>Show upload progress for multiple files</li>
                    <li>Add image editing tools (crop, rotate, annotate)</li>
                    <li>Support paste from clipboard (Cmd/Ctrl+V)</li>
                    <li>Add image gallery view mode</li>
                </ul>

                <h4>Features:</h4>
                <ul>
                    <li>OCR text extraction from images</li>
                    <li>Image search by visual similarity</li>
                    <li>Batch image operations (delete, tag, move)</li>
                    <li>Export images with metadata</li>
                </ul>
            </div>
        </div>

        <script>
            // Add collapsible functionality
            document.querySelectorAll('.collapsible-header').forEach(header => {
                header.addEventListener('click', () => {
                    const collapsible = header.parentElement;
                    collapsible.classList.toggle('open');
                });
            });

            // Open critical collapsibles by default
            document.querySelectorAll('.collapsible.critical').forEach(el => {
                el.classList.add('open');
            });
        </script>
    </div>
</body>
</html>