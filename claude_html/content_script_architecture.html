<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome Extension Content Scripts - Architecture Guide</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        :root {
            --chinese-red: #8B0000;
            --chinese-gold: #FFD700;
            --paper-beige: #F5F5DC;
            --light-cream: #FFFEF0;
            --ink-black: #2C2C2C;
            --level-1: #8B0000;
            --level-2: #A0522D;
            --level-3: #666;
            --level-4: #888;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, var(--paper-beige) 0%, var(--light-cream) 100%);
            color: var(--ink-black);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            font-size: 14px;
            line-height: 1.2;
            padding: 0;
            margin: 0;
            width: 100vw;
            max-width: 100%;
        }

        .container {
            width: 100%;
            padding: 12px;
        }

        h1 {
            font-size: 24px;
            font-weight: 900;
            margin: 4px 0;
            padding: 6px 4px;
            background: linear-gradient(135deg, var(--chinese-red), #CD5C5C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        h2 {
            font-size: 18px;
            font-weight: 700;
            margin: 12px 0 6px 0;
            padding: 4px;
            border-left: 4px solid var(--chinese-red);
            background: rgba(139, 0, 0, 0.03);
            color: var(--level-1);
        }

        h3 {
            font-size: 14px;
            font-weight: 600;
            margin: 8px 0 4px 8px;
            color: var(--level-2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        h4 {
            font-size: 12px;
            font-weight: 500;
            margin: 4px 0 2px 16px;
            color: var(--level-3);
        }

        .important-always-visible {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), white);
            border: 2px solid var(--chinese-gold);
            padding: 12px;
            margin: 12px 0;
            border-radius: 3px;
        }

        .important-always-visible h2 {
            color: var(--chinese-red);
            margin-top: 0;
            border: none;
            background: none;
            padding: 0 0 6px 0;
        }

        .primary-section {
            border: 2px solid var(--chinese-red);
            background: white;
            margin: 8px 0;
            padding: 8px;
        }

        .secondary-section {
            border-left: 3px solid var(--chinese-gold);
            background: rgba(255, 215, 0, 0.05);
            margin: 6px 0 6px 12px;
            padding: 6px;
        }

        .two-column-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 8px 0;
        }

        .card {
            background: white;
            border: 1px solid rgba(139, 0, 0, 0.2);
            border-radius: 2px;
            padding: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card.priority {
            border: 2px solid var(--chinese-gold);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.05), white);
        }

        .dense-list {
            list-style: none;
            padding: 0;
            margin: 4px 0 4px 12px;
        }

        .dense-list li {
            padding: 3px 0 3px 14px;
            border-left: 2px solid transparent;
            position: relative;
            line-height: 1.4;
        }

        .dense-list li:before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: var(--chinese-red);
            font-size: 10px;
        }

        .dense-list li strong {
            color: var(--level-2);
            font-weight: 600;
        }

        pre, code {
            background: linear-gradient(135deg, rgba(245, 245, 220, 0.3), rgba(255, 255, 255, 0.5));
            border: 1px solid rgba(139, 0, 0, 0.1);
            padding: 2px 4px;
            margin: 1px 0;
            font-size: 12px;
            line-height: 1.3;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
        }

        pre {
            padding: 8px;
            margin: 6px 0;
            overflow-x: auto;
        }

        pre code {
            background: none;
            border: none;
            padding: 0;
        }

        .collapsible {
            margin: 6px 0;
            width: 100%;
        }

        .collapsible-header {
            cursor: pointer;
            padding: 6px 8px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.05), rgba(255, 215, 0, 0.02));
            border-left: 3px solid var(--chinese-gold);
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .collapsible-header:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.1), rgba(255, 215, 0, 0.05));
        }

        .collapsible-header .arrow {
            display: inline-block;
            transition: transform 0.3s ease;
            color: var(--chinese-red);
            font-size: 10px;
            margin-right: 6px;
        }

        .collapsible.open .arrow {
            transform: rotate(90deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0 8px;
            margin-left: 12px;
        }

        .collapsible.open .collapsible-content {
            max-height: 5000px;
            padding: 8px;
        }

        .mermaid {
            background: white;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid rgba(139, 0, 0, 0.2);
            border-radius: 3px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 6px 0;
            font-size: 12px;
            background: white;
        }

        th, td {
            border: 1px solid rgba(139, 0, 0, 0.2);
            padding: 4px 6px;
            text-align: left;
            line-height: 1.3;
        }

        th {
            background: rgba(139, 0, 0, 0.1);
            font-weight: 600;
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, var(--chinese-red), transparent);
            margin: 12px 0;
        }

        .highlight {
            background: rgba(255, 215, 0, 0.2);
            padding: 1px 3px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chrome Extension Content Scripts: Complete Architecture Guide</h1>

        <div class="important-always-visible">
            <h2>üéØ Quick Answer: What is a Content Script?</h2>
            <p><strong>A content script is JavaScript code that runs in the context of web pages</strong> that your Chrome extension injects into. It has access to the DOM of web pages and can read/modify page content, but runs in an <strong>isolated world</strong> separate from the page's own JavaScript.</p>

            <ul class="dense-list" style="margin-top: 8px;">
                <li><strong>Access:</strong> Can read & modify page DOM, but NOT page JavaScript variables</li>
                <li><strong>Communication:</strong> Uses message passing to talk to background script</li>
                <li><strong>Typical Use:</strong> DOM manipulation, element selection, data extraction from pages</li>
            </ul>
        </div>

        <h2>üìä Complete Architecture Diagram</h2>
        <div class="mermaid">
graph TB
    subgraph "Web Page Context"
        DOM[Page DOM<br/>HTML Elements]
        PageJS[Page JavaScript<br/>window.variable]
    end

    subgraph "Content Script Context"
        CS[Content Script<br/>Injected JS]
        CSDOM[DOM Access<br/>‚úÖ Can Read/Modify]
    end

    subgraph "Extension Context"
        BG[Background Script<br/>Service Worker]
        POPUP[Popup/Canvas<br/>Extension Pages]
        STORAGE[(chrome.storage)]
    end

    DOM <-->|Full Access| CSDOM
    CSDOM <--> CS
    PageJS -.->|‚ùå Isolated| CS
    CS <-->|chrome.runtime<br/>sendMessage| BG
    BG <-->|Message Passing| POPUP
    BG <-->|Read/Write| STORAGE
    CS <-->|Limited APIs| STORAGE

    style CS fill:#FFD700,stroke:#8B0000,stroke-width:3px
    style BG fill:#F5F5DC,stroke:#8B0000,stroke-width:2px
    style DOM fill:#E8F5E9,stroke:#666
    style PageJS fill:#FFEBEE,stroke:#666
        </div>

        <h2>üèóÔ∏è Three Execution Contexts in Chrome Extensions</h2>

        <div class="two-column-layout">
            <div class="card priority">
                <h3>1Ô∏è‚É£ Content Script</h3>
                <ul class="dense-list">
                    <li><strong>Runs on:</strong> Every web page (based on manifest matches)</li>
                    <li><strong>Access:</strong> Page DOM (read/modify)</li>
                    <li><strong>Isolated from:</strong> Page's JavaScript variables</li>
                    <li><strong>Purpose:</strong> Interact with page content</li>
                </ul>
            </div>

            <div class="card priority">
                <h3>2Ô∏è‚É£ Background Script</h3>
                <ul class="dense-list">
                    <li><strong>Runs as:</strong> Service Worker (MV3)</li>
                    <li><strong>Access:</strong> Full Chrome APIs</li>
                    <li><strong>No DOM:</strong> Can't see page content</li>
                    <li><strong>Purpose:</strong> Coordination, persistence, APIs</li>
                </ul>
            </div>

            <div class="card">
                <h3>3Ô∏è‚É£ Extension Pages</h3>
                <ul class="dense-list">
                    <li><strong>Examples:</strong> Popup, options, canvas</li>
                    <li><strong>Access:</strong> Full Chrome APIs</li>
                    <li><strong>Own DOM:</strong> Independent UI</li>
                    <li><strong>Purpose:</strong> User interface</li>
                </ul>
            </div>

            <div class="card">
                <h3>üåê Web Page (Not Extension)</h3>
                <ul class="dense-list">
                    <li><strong>Context:</strong> Completely isolated</li>
                    <li><strong>No awareness:</strong> Can't detect content scripts</li>
                    <li><strong>Shared:</strong> Only the DOM</li>
                    <li><strong>Communication:</strong> Via DOM events (not recommended)</li>
                </ul>
            </div>
        </div>

        <h2>üîÑ How Content Script Relates to Background Script</h2>

        <div class="mermaid">
sequenceDiagram
    participant Page as Web Page DOM
    participant CS as Content Script
    participant BG as Background Script
    participant Storage as chrome.storage

    Note over Page,CS: Content script can access page DOM
    Page->>CS: User clicks element
    CS->>Page: Modify DOM (highlight)

    Note over CS,BG: Must use message passing
    CS->>BG: chrome.runtime.sendMessage({type: "SAVE_CARD"})
    BG->>Storage: chrome.storage.local.set()
    BG-->>CS: Response: {success: true}

    Note over BG: Background can initiate communication
    BG->>CS: chrome.tabs.sendMessage({type: "ACTIVATE_SELECTOR"})
    CS->>Page: Show element selector overlay
        </div>

        <div class="collapsible open">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span><span class="arrow">‚ñ∂</span>Communication Patterns</span>
            </div>
            <div class="collapsible-content">
                <table>
                    <thead>
                        <tr>
                            <th>Direction</th>
                            <th>Code Example</th>
                            <th>Use Case</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>CS ‚Üí BG</strong></td>
                            <td><code>chrome.runtime.sendMessage({data})</code></td>
                            <td>Send captured data to background</td>
                        </tr>
                        <tr>
                            <td><strong>BG ‚Üí CS</strong></td>
                            <td><code>chrome.tabs.sendMessage(tabId, {msg})</code></td>
                            <td>Trigger action in specific tab</td>
                        </tr>
                        <tr>
                            <td><strong>CS ‚Üí Storage</strong></td>
                            <td><code>chrome.storage.local.get()</code></td>
                            <td>Read settings (limited write access)</td>
                        </tr>
                        <tr>
                            <td><strong>BG ‚Üí Storage</strong></td>
                            <td><code>chrome.storage.local.set()</code></td>
                            <td>Primary storage operations</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <h2>‚úÖ What Content Scripts CAN Do</h2>

        <div class="secondary-section">
            <h3>DOM Access (Full)</h3>
            <ul class="dense-list">
                <li><strong>Read:</strong> <code>document.querySelector()</code>, <code>element.textContent</code></li>
                <li><strong>Modify:</strong> <code>element.style.background = 'yellow'</code></li>
                <li><strong>Create:</strong> <code>document.createElement()</code>, inject Shadow DOM</li>
                <li><strong>Events:</strong> <code>element.addEventListener('click', ...)</code></li>
            </ul>
        </div>

        <div class="secondary-section">
            <h3>Limited Chrome APIs</h3>
            <ul class="dense-list">
                <li><code>chrome.runtime</code> - Message passing, extension info</li>
                <li><code>chrome.storage</code> - Read/write extension storage</li>
                <li><code>chrome.i18n</code> - Internationalization</li>
                <li>‚ùå NO access to: <code>chrome.tabs</code>, <code>chrome.windows</code>, most other APIs</li>
            </ul>
        </div>

        <div class="secondary-section">
            <h3>Shadow DOM for Isolation</h3>
            <pre><code>// Inject UI without page CSS interference
const shadow = element.attachShadow({ mode: 'open' });
shadow.innerHTML = `
  &lt;style&gt;/* Isolated styles */&lt;/style&gt;
  &lt;div&gt;Your overlay&lt;/div&gt;
`;</code></pre>
        </div>

        <h2>‚ùå What Content Scripts CANNOT Do</h2>

        <div class="primary-section">
            <h3>üö´ No Access to Page JavaScript</h3>
            <pre><code>// On page: window.myVariable = 42;

// Content script:
console.log(window.myVariable); // ‚ùå undefined!
// Different JavaScript contexts - isolated worlds</code></pre>

            <h3>üö´ No Direct Tab/Window Control</h3>
            <pre><code>// ‚ùå These don't exist in content scripts:
chrome.tabs.create();  // Error!
chrome.windows.update();  // Error!

// ‚úÖ Must ask background script:
chrome.runtime.sendMessage({ action: "openTab", url });</code></pre>

            <h3>üö´ No Cross-Origin Fetch (Without Permissions)</h3>
            <p>Content scripts follow same-origin policy unless host permissions declared in manifest.</p>
        </div>

        <h2>üéØ Nabokov's Content Script Implementation</h2>

        <div class="mermaid">
sequenceDiagram
    participant User
    participant BG as Background<br/>(index.ts)
    participant CS as Content Script<br/>(content/index.tsx)
    participant Shadow as Shadow DOM<br/>(ElementSelector)
    participant Page as Web Page DOM

    User->>User: Press Cmd+Shift+E
    BG->>BG: Detect keyboard shortcut
    BG->>CS: sendMessage("ACTIVATE_SELECTOR")
    CS->>Shadow: Mount ElementSelector in Shadow DOM
    Shadow->>Page: Overlay on page (isolated CSS)

    User->>Shadow: Click element
    Shadow->>Page: Extract element HTML
    Shadow->>CS: Return captured data
    CS->>BG: sendMessage("SAVE_CARD", data)
    BG->>BG: Save to chrome.storage.local
        </div>

        <div class="collapsible open">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span><span class="arrow">‚ñ∂</span>Code Examples from Nabokov</span>
            </div>
            <div class="collapsible-content">
                <h4>Background Script (src/background/index.ts)</h4>
                <pre><code>// Trigger content script activation
chrome.commands.onCommand.addListener((command) => {
  if (command === "activate-selector") {
    chrome.tabs.query({ active: true }, (tabs) => {
      chrome.tabs.sendMessage(tabs[0].id, {
        type: "ACTIVATE_SELECTOR"
      });
    });
  }
});</code></pre>

                <h4>Content Script (src/content/index.tsx)</h4>
                <pre><code>// Listen for background messages
chrome.runtime.onMessage.addListener((message) => {
  if (message.type === "ACTIVATE_SELECTOR") {
    // Create Shadow DOM container
    const container = document.createElement('div');
    const shadow = container.attachShadow({ mode: 'open' });

    // Mount React component in Shadow DOM
    const root = createRoot(shadow);
    root.render(&lt;ElementSelector /&gt;);

    document.body.appendChild(container);
  }
});</code></pre>

                <h4>Why Shadow DOM?</h4>
                <ul class="dense-list">
                    <li><strong>CSS Isolation:</strong> Page styles don't affect extension UI</li>
                    <li><strong>Clean injection:</strong> Extension CSS doesn't leak to page</li>
                    <li><strong>Professional appearance:</strong> Consistent styling across all sites</li>
                </ul>
            </div>
        </div>

        <h2>üîç Key Architectural Decisions</h2>

        <div class="two-column-layout">
            <div class="card priority">
                <h3>Why Content Scripts?</h3>
                <ul class="dense-list">
                    <li>Only way to access page DOM</li>
                    <li>Element selection requires DOM access</li>
                    <li>Background scripts can't see pages</li>
                    <li>Perfect for injection & capture</li>
                </ul>
            </div>

            <div class="card priority">
                <h3>Why Background Scripts?</h3>
                <ul class="dense-list">
                    <li>Access full Chrome APIs</li>
                    <li>Persist across tabs</li>
                    <li>Handle storage operations</li>
                    <li>Coordinate between tabs</li>
                </ul>
            </div>

            <div class="card">
                <h3>Message Passing</h3>
                <ul class="dense-list">
                    <li>Content ‚Üî Background communication</li>
                    <li>Async by nature (Promise-based)</li>
                    <li>Serialized data (JSON-compatible)</li>
                    <li>Required by Chrome's security model</li>
                </ul>
            </div>

            <div class="card">
                <h3>Storage Strategy</h3>
                <ul class="dense-list">
                    <li>Background owns chrome.storage writes</li>
                    <li>Content scripts can read storage</li>
                    <li>Prevents race conditions</li>
                    <li>Centralized data management</li>
                </ul>
            </div>
        </div>

        <h2>üìã Manifest Configuration</h2>

        <div class="collapsible open">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span><span class="arrow">‚ñ∂</span>Content Script Declaration (manifest.json)</span>
            </div>
            <div class="collapsible-content">
                <pre><code>{
  "manifest_version": 3,
  "content_scripts": [
    {
      "matches": ["&lt;all_urls&gt;"],  // Which pages to inject into
      "js": ["src/content/index.tsx"],  // Script to inject
      "run_at": "document_idle",        // When: after DOM ready
      "all_frames": false               // Main frame only
    }
  ],
  "background": {
    "service_worker": "src/background/index.ts",
    "type": "module"
  }
}</code></pre>

                <h4>Key Options</h4>
                <table>
                    <tr>
                        <th>Option</th>
                        <th>Values</th>
                        <th>Nabokov Uses</th>
                    </tr>
                    <tr>
                        <td><code>matches</code></td>
                        <td>URL patterns</td>
                        <td><code>&lt;all_urls&gt;</code> - all websites</td>
                    </tr>
                    <tr>
                        <td><code>run_at</code></td>
                        <td>document_start | document_end | document_idle</td>
                        <td><code>document_idle</code> - waits for DOM</td>
                    </tr>
                    <tr>
                        <td><code>all_frames</code></td>
                        <td>true | false</td>
                        <td><code>false</code> - main frame only</td>
                    </tr>
                </table>
            </div>
        </div>

        <h2>‚ö° Common Patterns & Best Practices</h2>

        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span><span class="arrow">‚ñ∂</span>Pattern 1: On-Demand Injection (Lazy Loading)</span>
            </div>
            <div class="collapsible-content">
                <p>Don't run content script code until needed:</p>
                <pre><code>// Content script stays dormant until activated
chrome.runtime.onMessage.addListener((message) => {
  if (message.type === "ACTIVATE_SELECTOR") {
    // Only now load heavy components
    initializeElementSelector();
  }
});

// Nabokov uses this pattern - no performance impact until Cmd+Shift+E</code></pre>
            </div>
        </div>

        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span><span class="arrow">‚ñ∂</span>Pattern 2: Promise-Based Message Passing</span>
            </div>
            <div class="collapsible-content">
                <pre><code>// Modern async/await pattern
async function saveCard(cardData) {
  const response = await chrome.runtime.sendMessage({
    type: "SAVE_CARD",
    data: cardData
  });

  if (response.success) {
    console.log("Card saved:", response.cardId);
  }
}</code></pre>
            </div>
        </div>

        <div class="collapsible">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <span><span class="arrow">‚ñ∂</span>Pattern 3: Shadow DOM for UI Isolation</span>
            </div>
            <div class="collapsible-content">
                <pre><code>// Prevent page CSS from breaking extension UI
const container = document.createElement('div');
const shadow = container.attachShadow({ mode: 'open' });

shadow.innerHTML = `
  &lt;style&gt;
    /* These styles are isolated from page */
    .overlay { background: rgba(139, 0, 0, 0.1); }
  &lt;/style&gt;
  &lt;div class="overlay"&gt;Extension UI&lt;/div&gt;
`;

document.body.appendChild(container);</code></pre>
            </div>
        </div>

        <h2>üêõ Common Issues & Solutions</h2>

        <table>
            <thead>
                <tr>
                    <th>Problem</th>
                    <th>Cause</th>
                    <th>Solution</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Content script not responding</td>
                    <td>Manifest matches wrong, or script error</td>
                    <td>Check <code>matches</code> pattern, check console for errors</td>
                </tr>
                <tr>
                    <td>Can't access page variables</td>
                    <td>Isolated JavaScript contexts</td>
                    <td>Use DOM events or <code>window.postMessage</code> (not recommended)</td>
                </tr>
                <tr>
                    <td>Page CSS breaks extension UI</td>
                    <td>Global CSS inheritance</td>
                    <td>Use Shadow DOM for complete isolation</td>
                </tr>
                <tr>
                    <td>Message not received</td>
                    <td>Async timing, service worker inactive</td>
                    <td>Add response callbacks, check background worker logs</td>
                </tr>
                <tr>
                    <td>Extension not updating</td>
                    <td>Chrome caches old code</td>
                    <td>Reload extension in chrome://extensions after build</td>
                </tr>
            </tbody>
        </table>

        <div class="divider"></div>

        <h2>üéì Summary</h2>

        <div class="important-always-visible">
            <h3>Content Scripts Are...</h3>
            <ul class="dense-list">
                <li><strong>The DOM Access Layer:</strong> Only way for extensions to see/modify web pages</li>
                <li><strong>Isolated JavaScript Context:</strong> Can't access page's JS, only DOM</li>
                <li><strong>Message-Driven:</strong> Communicate with background via <code>chrome.runtime.sendMessage</code></li>
                <li><strong>Limited API Access:</strong> Subset of Chrome APIs (runtime, storage, i18n)</li>
                <li><strong>Injected Per-Page:</strong> Each tab gets its own content script instance</li>
            </ul>

            <h3>Background Scripts Are...</h3>
            <ul class="dense-list">
                <li><strong>The Orchestration Layer:</strong> Coordinates across tabs, handles events</li>
                <li><strong>Full API Access:</strong> Can use all Chrome APIs (tabs, windows, storage, etc.)</li>
                <li><strong>No DOM Access:</strong> Can't see page content directly</li>
                <li><strong>Service Worker (MV3):</strong> Event-driven, can sleep when idle</li>
            </ul>

            <h3>They Work Together Via...</h3>
            <ul class="dense-list">
                <li><strong>Message Passing:</strong> <code>sendMessage</code> / <code>onMessage</code> pattern</li>
                <li><strong>Shared Storage:</strong> <code>chrome.storage</code> for data persistence</li>
                <li><strong>Event Coordination:</strong> Background triggers content script actions</li>
            </ul>
        </div>

    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#FFD700',
                primaryTextColor: '#2C2C2C',
                primaryBorderColor: '#8B0000',
                lineColor: '#8B0000',
                secondaryColor: '#F5F5DC',
                tertiaryColor: '#FFFEF0'
            }
        });

        function toggleCollapsible(header) {
            const collapsible = header.parentElement;
            collapsible.classList.toggle('open');
        }
    </script>
</body>
</html>