<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hypertext Palette Integration Anywhere</title>
<style>
:root {
    --chinese-red: #8B0000;
    --chinese-gold: #FFD700;
    --paper-beige: #F5F5DC;
    --light-cream: #FFFEF0;
    --ink-black: #1A1A1A;
    --level-1: #7A0C0C;
    --level-2: #9B1A1A;
    --level-3: #B83232;
    --level-4: #D15A5A;
    --muted: #6B6B6B;
    --critical-bg: rgba(139,0,0,0.12);
    --important-bg: rgba(139,0,0,0.08);
    --normal-bg: rgba(139,0,0,0.04);
}
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
body {
    background: linear-gradient(135deg, var(--paper-beige) 0%, var(--light-cream) 100%);
    color: var(--ink-black);
    margin: 0;
    padding: 0;
    width: 100vw;
    max-width: 100%;
    line-height: 1.2;
    font-size: 14px;
    font-family: "SF Pro Text", "Segoe UI", Roboto, Arial, sans-serif;
}
.container {
    width: 100%;
    padding: 4px 6px 16px 6px;
}
header {
    padding: 6px;
    border-bottom: 1px solid rgba(139,0,0,0.15);
}
h1 {
    font-size: 24px;
    font-weight: 900;
    margin: 4px 0;
    padding: 6px 4px;
    background: linear-gradient(135deg, var(--chinese-red), #CD5C5C);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: -0.5px;
}
h2 {
    font-size: 18px;
    font-weight: 700;
    margin: 8px 0 4px 0;
    padding: 4px;
    border-left: 4px solid var(--chinese-red);
    background: rgba(139, 0, 0, 0.03);
    color: var(--level-1);
}
h3 {
    font-size: 14px;
    font-weight: 600;
    margin: 4px 0 2px 8px;
    color: var(--level-2);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
h4 {
    font-size: 12px;
    font-weight: 500;
    margin: 2px 0 1px 16px;
    color: var(--level-3);
}
h5, h6 {
    font-size: 11px;
    font-weight: 500;
    margin: 1px 0 1px 24px;
    color: var(--level-4);
}
.meta {
    font-size: 11px;
    color: var(--muted);
    margin: 0 0 4px 6px;
}
.control-bar {
    display: flex;
    justify-content: flex-end;
    gap: 6px;
    padding: 6px;
}
.control-bar button {
    font-size: 11px;
    padding: 4px 8px;
    border: 1px solid rgba(139,0,0,0.35);
    background: rgba(139,0,0,0.05);
    color: var(--level-1);
    border-radius: 999px;
    cursor: pointer;
    transition: background 0.2s ease;
}
.control-bar button:hover {
    background: rgba(139,0,0,0.15);
}
.important-always-visible {
    margin: 4px;
    padding: 8px;
    border: 1px solid rgba(139,0,0,0.22);
    border-radius: 8px;
    background: var(--critical-bg);
}
.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
    gap: 6px;
    margin-top: 6px;
}
.badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    background: rgba(139,0,0,0.12);
    color: var(--level-2);
    padding: 3px 8px;
    border-radius: 6px;
    border: 1px solid rgba(139,0,0,0.18);
}
.dense-list {
    list-style: none;
    display: grid;
    gap: 4px;
}
.dense-list li {
    padding: 4px 6px;
    background: rgba(139,0,0,0.05);
    border-radius: 6px;
    border: 1px solid rgba(139,0,0,0.08);
}
.dense-list li strong {
    color: var(--level-1);
}
.tag-row {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}
.tag {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.6px;
    padding: 2px 6px;
    border-radius: 999px;
    border: 1px solid rgba(139,0,0,0.25);
    background: rgba(139,0,0,0.08);
    color: var(--level-2);
}
.two-column-layout {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 8px;
    margin: 8px 4px;
}
.collapsible {
    border: 1px solid rgba(139,0,0,0.18);
    border-radius: 10px;
    background: var(--normal-bg);
    overflow: hidden;
}
.collapsible.full-width {
    grid-column: 1 / -1;
}
.collapsible-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    cursor: pointer;
    background: rgba(139,0,0,0.1);
    font-size: 12px;
    font-weight: 600;
    color: var(--level-1);
}
.collapsible-header span:first-child {
    display: inline-flex;
    align-items: center;
    gap: 6px;
}
.arrow {
    transition: transform 0.2s ease;
}
.collapsible.open .arrow {
    transform: rotate(90deg);
}
.collapsible-content {
    display: none;
    padding: 8px 10px 10px 10px;
    background: rgba(255,255,255,0.88);
}
.collapsible.open .collapsible-content {
    display: block;
}
.section-body {
    display: grid;
    gap: 6px;
}
.code-block {
    background: #1F1F1F;
    color: #EFEFEF;
    padding: 8px;
    border-radius: 6px;
    font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    font-size: 12px;
    overflow: auto;
    border: 1px solid rgba(255,255,255,0.08);
}
.code-block strong {
    color: #FFD700;
}
.meta-grid {
    display: grid;
    gap: 4px;
    font-size: 11px;
    color: var(--muted);
}
.callout {
    border-left: 3px solid var(--chinese-red);
    padding: 6px 8px;
    background: rgba(139,0,0,0.08);
    border-radius: 6px;
    font-size: 12px;
}
.status-line {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: var(--muted);
}
.critical {
    color: var(--chinese-red);
    font-weight: 700;
}
.important {
    color: var(--level-2);
    font-weight: 600;
}
.warning {
    color: #B8860B;
    font-weight: 600;
}
.muted {
    color: var(--muted);
}
footer {
    margin: 10px 4px 0 4px;
    font-size: 11px;
    color: var(--muted);
    text-align: right;
}
@media (max-width: 720px) {
    body {
        font-size: 13px;
        line-height: 1.25;
    }
    h1 {
        font-size: 22px;
    }
    h2 {
        font-size: 16px;
    }
}
</style>
</head>
<body>
<div class="container">
    <header>
        <h1>Hypertext Palette Anywhere</h1>
        <p class="meta">Fucheng Warren Zhu ¬∑ Generated October 5, 2025 ¬∑ Target: Chrome MV3 or manual injection</p>
    </header>
    <div class="control-bar">
        <button id="expand-all">Expand All</button>
        <button id="collapse-all">Collapse All</button>
    </div>
    <div class="important-always-visible">
        <h2>üéØ Critical Integration Path</h2>
        <div class="info-grid">
            <div class="callout">
                <div class="status-line"><span class="critical">Goal</span><span class="tag">Selection-triggered palette</span></div>
                <p>Inject the existing <strong>hypertext_navigation_demo</strong> UI into any page so highlighted text summons the palette and modal workflow.</p>
            </div>
            <ul class="dense-list">
                <li><strong>Strategy:</strong> MV3 content script injects demo markup inside a Shadow DOM + reuses demo JS.</li>
                <li><strong>Trigger:</strong> `mouseup`, `selectionchange`, and `Ctrl/‚åò+Shift+K` listeners reopen the palette on highlighted text.</li>
                <li><strong>Reuse:</strong> Store `hypertext_navigation_demo.html` as a web-accessible resource; bootstrap via `fetch(chrome.runtime.getURL(...))`.</li>
            </ul>
            <div class="dense-list">
                <div class="badge">‚öôÔ∏è Zero-page-mod rebuild</div>
                <div class="badge">ü™ü Shadow DOM isolation</div>
                <div class="badge">üõ∞Ô∏è Optional background resolver</div>
            </div>
        </div>
    </div>
    <div class="two-column-layout">
        <section class="collapsible" data-collapsible="open">
            <div class="collapsible-header">
                <span>üì¶ Chrome Extension Skeleton</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="collapsible-content">
                <div class="section-body">
                    <div class="meta-grid">
                        <div>Scope: `matches` for the domains you trust (or `<all_urls>` for broad testing).</div>
                        <div>Files: place existing demo as `assets/hypertext_palette.html` inside the extension.</div>
                    </div>
                    <div class="code-block"><pre><code>{
  "manifest_version": 3,
  "name": "Hypertext Palette Anywhere",
  "version": "0.1.0",
  "description": "Highlight text on any page to open the hypertext navigation palette.",
  "permissions": ["scripting", "storage"],
  "host_permissions": ["https://*/", "http://*/"],
  "background": { "service_worker": "background.js" },
  "content_scripts": [{
    "matches": ["<all_urls>"],
    "js": ["content.js"],
    "run_at": "document_idle"
  }],
  "web_accessible_resources": [{
    "resources": ["assets/hypertext_palette.html", "assets/palette.css"],
    "matches": ["<all_urls>"]
  }]
}</code></pre></div>
                    <p class="muted">If the palette generates outbound requests, add granular domains to `host_permissions` and proxy through `background.js` to bypass CORS issues.</p>
                </div>
            </div>
        </section>
        <section class="collapsible" data-collapsible="closed">
            <div class="collapsible-header">
                <span>üß© Content Script Bootstrap</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="collapsible-content">
                <div class="section-body">
                    <p>Load the demo markup, mount it inside a Shadow DOM, and expose palette functions back to the page.</p>
                    <div class="code-block"><pre><code>// content.js
const ROOT_ID = "hypertext-palette-root";
if (!document.getElementById(ROOT_ID)) {
  const host = document.createElement("div");
  host.id = ROOT_ID;
  host.style.all = "initial";
  document.documentElement.appendChild(host);
  const shadow = host.attachShadow({ mode: "open" });

  (async () => {
    const htmlUrl = chrome.runtime.getURL("assets/hypertext_palette.html");
    const response = await fetch(htmlUrl);
    const html = await response.text();
    shadow.innerHTML = html;
    shadow.querySelectorAll("script").forEach((script) => {
      const clone = document.createElement("script");
      clone.textContent = script.textContent;
      shadow.appendChild(clone);
      script.remove();
    });
    initializePalette(shadow); // defined inside injected script
  })();
}
</code></pre></div>
                    <p class="muted">Keep palette assets self-contained. Moving inline scripts into modules avoids CSP conflicts on stricter sites.</p>
                </div>
            </div>
        </section>
        <section class="collapsible" data-collapsible="closed">
            <div class="collapsible-header">
                <span>üñ±Ô∏è Selection Hooks & UI</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="collapsible-content">
                <div class="section-body">
                    <ul class="dense-list">
                        <li><strong>Event wiring:</strong> Mirror the demo's `selectionchange`, `mouseup`, and palette hotkey handlers inside the Shadow DOM; forward page selections into the injected app.</li>
                        <li><strong>Range cloning:</strong> Use `activeRange = selection.getRangeAt(0).cloneRange()` so the wrap/unwrap logic remains identical to the demo.</li>
                        <li><strong>Palette placement:</strong> Convert viewport-relative rects to page coordinates via `rect.left + window.scrollX` to survive scrolled pages and fixed layouts.</li>
                        <li><strong>CSS isolation:</strong> Preserve the demo styles in `palette.css`; append them to the shadow root so host pages cannot override pill states.</li>
                    </ul>
                    <div class="callout">Expose a small API on `window.hypertextPalette` (e.g., `open()`, `applyHypertext()`) to aid future automation or context-menu triggers.</div>
                </div>
            </div>
        </section>
        <section class="collapsible" data-collapsible="closed">
            <div class="collapsible-header">
                <span>üõ∞Ô∏è Background Worker (Optional)</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="collapsible-content">
                <div class="section-body">
                    <p>Proxy any network-bound `resolveHypertext` calls through a service worker for reliability and CSP bypass.</p>
                    <div class="code-block"><pre><code>// background.js
chrome.runtime.onMessage.addListener((msg, sender, sendResponse) =&gt; {
  if (msg.type === "hypertext:resolve") {
    fetch("https://your-api.example/resolve", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        selection: msg.selection,
        instructions: msg.instructions
      })
    }).then(async (res) =&gt; {
      sendResponse(await res.json());
    }).catch((error) =&gt; sendResponse({ error: String(error) }));
    return true; // keep channel open
  }
});
</code></pre></div>
                    <p class="muted">Use `chrome.storage.sync` to remember last-used instructions across tabs; throttle requests for very large selections.</p>
                </div>
            </div>
        </section>
    </div>
    <div class="two-column-layout">
        <section class="collapsible full-width" data-collapsible="closed">
            <div class="collapsible-header">
                <span>üß™ Testing & Hardening Checklist</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="collapsible-content">
                <div class="section-body">
                    <ul class="dense-list">
                        <li><strong>Cross-origin pages:</strong> Verify palette mounting on `https://docs.google.com`, `https://developer.mozilla.org`, and local file URLs (requires `file://` permission toggle).</li>
                        <li><strong>Shadow conflicts:</strong> Ensure host page fonts do not leak in; add fallback fonts directly inside the shadow stylesheet.</li>
                        <li><strong>Selection edge cases:</strong> Test with nested inline elements, content-editable regions, and right-to-left text.</li>
                        <li><strong>Cleanup:</strong> On `visibilitychange` or page navigation in SPA contexts, revalidate the host element to prevent duplicate mounts.</li>
                        <li><strong>Metrics:</strong> Optionally emit `chrome.runtime.sendMessage({ type: "hypertext:telemetry" })` for usage tracking.</li>
                    </ul>
                </div>
            </div>
        </section>
        <section class="collapsible full-width" data-collapsible="closed">
            <div class="collapsible-header">
                <span>üß≠ Alternative Injection Paths</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="collapsible-content">
                <div class="section-body">
                    <ul class="dense-list">
                        <li><strong>Bookmarklet:</strong> Minify the bootstrap script and host palette assets on a CDN; `fetch` the HTML + CSS on demand.</li>
                        <li><strong>User script:</strong> Adapt for Tampermonkey/Greasemonkey by exporting an ES module that injects the demo the same way.</li>
                        <li><strong>Server-side embed:</strong> For owned sites, drop the demo HTML into a partial and gate initialization behind `DOMContentLoaded`.</li>
                    </ul>
                    <p class="muted">All paths should share the same palette bundle to ensure UI parity with the original demo.</p>
                </div>
            </div>
        </section>
        <section class="collapsible full-width" data-collapsible="open">
            <div class="collapsible-header">
                <span>üìÇ Delivery Notes</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="collapsible-content">
                <div class="section-body">
                    <p><strong>Saved file:</strong> <code>claude_html/hypertext_palette_integration.html</code>.</p>
                    <p class="muted">Open from `chrome://extensions` ‚ûù Load unpacked ‚ûù select your extension folder once assets are arranged per the structure above.</p>
                </div>
            </div>
        </section>
    </div>
    <footer>
        Highlight text on any page ‚Üí palette appears ‚Üí generate hypertext exactly as in the original demo.
    </footer>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('[data-collapsible]').forEach(function(section) {
        const isOpen = section.getAttribute('data-collapsible') === 'open';
        section.classList.add('collapsible');
        if (isOpen) section.classList.add('open');
    });
    document.querySelectorAll('.collapsible-header').forEach(function(header) {
        header.addEventListener('click', function() {
            const collapsible = this.closest('.collapsible');
            collapsible.classList.toggle('open');
        });
    });
    const expandAllBtn = document.getElementById('expand-all');
    const collapseAllBtn = document.getElementById('collapse-all');
    if (expandAllBtn) {
        expandAllBtn.addEventListener('click', function() {
            document.querySelectorAll('.collapsible').forEach(function(c) {
                c.classList.add('open');
            });
        });
    }
    if (collapseAllBtn) {
        collapseAllBtn.addEventListener('click', function() {
            document.querySelectorAll('.collapsible').forEach(function(c) {
                c.classList.remove('open');
            });
        });
    }
});
</script>
</body>
</html>
